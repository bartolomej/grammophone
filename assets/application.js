var ApplicationController=function(){"use strict";function s(t,e,r,n,s,i){return{tag:t,key:e,attrs:r,children:n,text:s,dom:i,domSize:void 0,state:void 0,events:void 0,instance:void 0}}s.normalize=function(t){return Array.isArray(t)?s("[",void 0,void 0,s.normalizeChildren(t),void 0,void 0):null==t||"boolean"==typeof t?null:"object"==typeof t?t:s("#",void 0,void 0,String(t),void 0,void 0)},s.normalizeChildren=function(t){var e=[];if(t.length){for(var r=null!=t[0]&&null!=t[0].key,n=1;n<t.length;n++)if((null!=t[n]&&null!=t[n].key)!=r)throw new TypeError("Vnodes must either always have keys or never have keys!");for(n=0;n<t.length;n++)e[n]=s.normalize(t[n])}return e};var t,l,d,e,h,P,r,n=s,p=n,i=(t=window,d=t&&t.document,e={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},h={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"},P=[],r=/[A-Z]/g,(D.prototype=Object.create(null)).handleEvent=function(t){var e,r=this["on"+t.type];"function"==typeof r?e=r.call(t.currentTarget,t):"function"==typeof r.handleEvent&&r.handleEvent(t),this._&&!1!==t.redraw&&(0,this._)(),!1===e&&(t.preventDefault(),t.stopPropagation())},function(t,e,r){if(!t)throw new TypeError("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var n=[],s=f(),i=t.namespaceURI;null==t.vnodes&&(t.textContent=""),e=p.normalizeChildren(Array.isArray(e)?e:[e]);var o=l;try{l="function"==typeof r?r:void 0,b(t,t.vnodes,e,n,null,"http://www.w3.org/1999/xhtml"===i?void 0:i)}finally{l=o}t.vnodes=e,null!=s&&f()!==s&&"function"==typeof s.focus&&s.focus();for(var a=0;a<n.length;a++)n[a]()});function m(t){return t.attrs&&t.attrs.xmlns||e[t.tag]}function u(t,e){if(t.state!==e)throw new Error("`vnode.state` must not be modified")}function g(t){var e=t.state;try{return this.apply(e,arguments)}finally{u(t,e)}}function f(){try{return d.activeElement}catch(t){return null}}function E(t,e,r,n,s,i,o){for(var a=r;a<n;a++){var l=e[a];null!=l&&O(t,l,s,o,i)}}function O(t,e,r,n,s){var i,o,a,l,h,u,c,f=e.tag;if("string"==typeof f)switch(e.state={},null!=e.attrs&&$(e.attrs,e,r),f){case"#":h=t,c=s,(u=e).dom=d.createTextNode(u.children),x(h,u.dom,c);break;case"<":v(t,e,n,s);break;case"[":!function(t,e,r,n,s){var i=d.createDocumentFragment();{var o;null!=e.children&&(o=e.children,E(i,o,0,o.length,r,null,n))}e.dom=i.firstChild,e.domSize=i.childNodes.length,x(t,i,s)}(t,e,r,n,s);break;default:!function(t,e,r,n,s){var i=e.tag,o=e.attrs,a=o&&o.is,i=(n=m(e)||n)?a?d.createElementNS(n,i,{is:a}):d.createElementNS(n,i):a?d.createElement(i,{is:a}):d.createElement(i);e.dom=i,null!=o&&function(t,e,r){for(var n in e)w(t,n,null,e[n],r)}(e,o,n);x(t,i,s),y(e)||(null!=e.text&&(""!==e.text?i.textContent=e.text:e.children=[p("#",void 0,void 0,e.text,void 0,void 0)]),null!=e.children&&(s=e.children,E(i,s,0,s.length,r,null,n),"select"===e.tag&&null!=o&&function(t,e){{var r;"value"in e&&(null===e.value?-1!==t.dom.selectedIndex&&(t.dom.value=null):(r=""+e.value,t.dom.value===r&&-1!==t.dom.selectedIndex||(t.dom.value=r)))}"selectedIndex"in e&&w(t,"selectedIndex",null,e.selectedIndex,void 0)}(e,o)))}(t,e,r,n,s)}else i=t,a=n,l=s,function(t,e){var r;if("function"==typeof t.tag.view){if(t.state=Object.create(t.tag),null!=(r=t.state.view).$$reentrantLock$$)return;r.$$reentrantLock$$=!0}else{if(t.state=void 0,null!=(r=t.tag).$$reentrantLock$$)return;r.$$reentrantLock$$=!0,t.state=null!=t.tag.prototype&&"function"==typeof t.tag.prototype.view?new t.tag(t):t.tag(t)}$(t.state,t,e),null!=t.attrs&&$(t.attrs,t,e);if(t.instance=p.normalize(g.call(t.state.view,t)),t.instance===t)throw Error("A view cannot return the vnode it received as argument");r.$$reentrantLock$$=null}(o=e,f=r),null!=o.instance?(O(i,o.instance,f,a,l),o.dom=o.instance.dom,o.domSize=null!=o.dom?o.instance.domSize:0):o.domSize=0}function v(t,e,r,n){var s=e.children.match(/^\s*?<(\w+)/im)||[],i=d.createElement(h[s[1]]||"div");"http://www.w3.org/2000/svg"===r?(i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+e.children+"</svg>",i=i.firstChild):i.innerHTML=e.children,e.dom=i.firstChild,e.domSize=i.childNodes.length,e.instance=[];for(var o,a=d.createDocumentFragment();o=i.firstChild;)e.instance.push(o),a.appendChild(o);x(t,a,n)}function b(t,e,r,n,s,i){if(e!==r&&(null!=e||null!=r))if(null==e||0===e.length)E(t,r,0,r.length,n,s,i);else if(null==r||0===r.length)L(t,e,0,e.length);else{var o=null!=e[0]&&null!=e[0].key,a=null!=r[0]&&null!=r[0].key,l=0,h=0;if(!o)for(;h<e.length&&null==e[h];)h++;if(!a)for(;l<r.length&&null==r[l];)l++;if(null!==a||null!=o)if(o!=a)L(t,e,h,e.length),E(t,r,l,r.length,n,s,i);else if(a){for(var u,c,f,d,p=e.length-1,m=r.length-1;h<=p&&l<=m&&(f=e[p],S=r[m],f.key===S.key);)f!==S&&T(t,f,S,n,s,i),null!=S.dom&&(s=S.dom),p--,m--;for(;h<=p&&l<=m&&(u=e[h],c=r[l],u.key===c.key);)h++,l++,u!==c&&T(t,u,c,n,N(e,h,s),i);for(;h<=p&&l<=m&&l!==m&&u.key===S.key&&f.key===c.key;)z(t,f,d=N(e,h,s)),f!==c&&T(t,f,c,n,d,i),++l<=--m&&z(t,u,s),u!==S&&T(t,u,S,n,s,i),null!=S.dom&&(s=S.dom),f=e[--p],S=r[m],u=e[++h],c=r[l];for(;h<=p&&l<=m&&f.key===S.key;)f!==S&&T(t,f,S,n,s,i),null!=S.dom&&(s=S.dom),f=e[--p],S=r[--m];if(m<l)L(t,e,h,p+1);else if(p<h)E(t,r,l,m+1,n,s,i);else{for(var g,v,a=s,b=m-l+1,x=new Array(b),y=0,_=0,k=2147483647,w=0,_=0;_<b;_++)x[_]=-1;for(_=m;l<=_;_--){var S,C=(g=null==g?function(t,e,r){for(var n=Object.create(null);e<r;e++){var s=t[e];null==s||null!=(s=s.key)&&(n[s]=e)}return n}(e,h,p+1):g)[(S=r[_]).key];null!=C&&(k=C<k?C:-1,f=e[x[_-l]=C],e[C]=null,f!==S&&T(t,f,S,n,s,i),null!=S.dom&&(s=S.dom),w++)}if(s=a,w!==p-h+1&&L(t,e,h,p+1),0===w)E(t,r,l,m+1,n,s,i);else if(-1===k)for(y=(v=function(t){for(var e=[0],r=0,n=0,s=0,i=P.length=t.length,s=0;s<i;s++)P[s]=t[s];for(s=0;s<i;++s)if(-1!==t[s]){var o=e[e.length-1];if(t[o]<t[s])P[s]=o,e.push(s);else{for(r=0,n=e.length-1;r<n;){var a=(r>>>1)+(n>>>1)+(r&n&1);t[e[a]]<t[s]?r=1+a:n=a}t[s]<t[e[r]]&&(0<r&&(P[s]=e[r-1]),e[r]=s)}}r=e.length,n=e[r-1];for(;0<r--;)e[r]=n,n=P[n];return P.length=0,e}(x)).length-1,_=m;l<=_;_--)c=r[_],-1===x[_-l]?O(t,c,n,i,s):v[y]===_-l?y--:z(t,c,s),null!=c.dom&&(s=r[_].dom);else for(_=m;l<=_;_--)c=r[_],-1===x[_-l]&&O(t,c,n,i,s),null!=c.dom&&(s=r[_].dom)}}else{for(var A=(e.length<r.length?e:r).length,l=l<h?l:h;l<A;l++)(u=e[l])===(c=r[l])||null==u&&null==c||(null==u?O(t,c,n,i,N(e,l+1,s)):null==c?R(t,u):T(t,u,c,n,N(e,l+1,s),i));e.length>A&&L(t,e,l,e.length),r.length>A&&E(t,r,l,r.length,n,s,i)}}}function T(t,e,r,n,s,i){var o,a,l,h,u,c=e.tag;if(c===r.tag){if(r.state=e.state,r.events=e.events,!function(t,e){do{var r;if(null!=t.attrs&&"function"==typeof t.attrs.onbeforeupdate)if(void 0!==(r=g.call(t.attrs.onbeforeupdate,t,e))&&!r)break;if("string"!=typeof t.tag&&"function"==typeof t.state.onbeforeupdate)if(void 0!==(r=g.call(t.state.onbeforeupdate,t,e))&&!r)break;return!1}while(0);return t.dom=e.dom,t.domSize=e.domSize,t.instance=e.instance,t.attrs=e.attrs,t.children=e.children,t.text=e.text,!0}(r,e))if("string"==typeof c)switch(null!=r.attrs&&F(r.attrs,r,n),c){case"#":!function(t,e){t.children.toString()!==e.children.toString()&&(t.dom.nodeValue=e.children);e.dom=t.dom}(e,r);break;case"<":o=t,l=r,h=i,u=s,(a=e).children!==l.children?(_(o,a),v(o,l,h,u)):(l.dom=a.dom,l.domSize=a.domSize,l.instance=a.instance);break;case"[":!function(t,e,r,n,s,i){b(t,e.children,r.children,n,s,i);var o=0,a=r.children;if(r.dom=null,null!=a){for(var l=0;l<a.length;l++){var h=a[l];null!=h&&null!=h.dom&&(null==r.dom&&(r.dom=h.dom),o+=h.domSize||1)}1!==o&&(r.domSize=o)}}(t,e,r,n,s,i);break;default:!function(t,e,r,n){var s=e.dom=t.dom;n=m(e)||n,"textarea"===e.tag&&(null==e.attrs&&(e.attrs={}),null!=e.text&&(e.attrs.value=e.text,e.text=void 0));(function(t,e,r,n){if(null!=r)for(var s in r)w(t,s,e&&e[s],r[s],n);var i;if(null!=e)for(var s in e)null==(i=e[s])||null!=r&&null!=r[s]||function(t,e,r,n){"key"===e||"is"===e||null==r||S(e)||("o"!==e[0]||"n"!==e[1]||S(e)?"style"===e?A(t.dom,r,null):!C(t,e,n)||"className"===e||"value"===e&&("option"===t.tag||"select"===t.tag&&-1===t.dom.selectedIndex&&t.dom===f())||"input"===t.tag&&"type"===e?(-1!==(n=e.indexOf(":"))&&(e=e.slice(n+1)),!1!==r&&t.dom.removeAttribute("className"===e?"class":e)):t.dom[e]=null:I(t,e,void 0))}(t,s,i,n)})(e,t.attrs,e.attrs,n),y(e)||(null!=t.text&&null!=e.text&&""!==e.text?t.text.toString()!==e.text.toString()&&(t.dom.firstChild.nodeValue=e.text):(null!=t.text&&(t.children=[p("#",void 0,void 0,t.text,void 0,t.dom.firstChild)]),null!=e.text&&(e.children=[p("#",void 0,void 0,e.text,void 0,void 0)]),b(s,t.children,e.children,r,null,n)))}(e,r,n,i)}else!function(t,e,r,n,s,i){if(r.instance=p.normalize(g.call(r.state.view,r)),r.instance===r)throw Error("A view cannot return the vnode it received as argument");F(r.state,r,n),null!=r.attrs&&F(r.attrs,r,n);null!=r.instance?(null==e.instance?O(t,r.instance,n,i,s):T(t,e.instance,r.instance,n,s,i),r.dom=r.instance.dom,r.domSize=r.instance.domSize):null!=e.instance?(R(t,e.instance),r.dom=void 0,r.domSize=0):(r.dom=e.dom,r.domSize=e.domSize)}(t,e,r,n,s,i)}else R(t,e),O(t,r,n,i,s)}function N(t,e,r){for(;e<t.length;e++)if(null!=t[e]&&null!=t[e].dom)return t[e].dom;return r}function z(t,e,r){var n=d.createDocumentFragment();!function t(e,r,n){for(;null!=n.dom&&n.dom.parentNode===e;){if("string"!=typeof n.tag){if(null!=(n=n.instance))continue}else if("<"===n.tag)for(var s=0;s<n.instance.length;s++)r.appendChild(n.instance[s]);else if("["!==n.tag)r.appendChild(n.dom);else if(1===n.children.length){if(null!=(n=n.children[0]))continue}else for(s=0;s<n.children.length;s++){var i=n.children[s];null!=i&&t(e,r,i)}break}}(t,n,e),x(t,n,r)}function x(t,e,r){null!=r?t.insertBefore(e,r):t.appendChild(e)}function y(t){if(null!=t.attrs&&(null!=t.attrs.contenteditable||null!=t.attrs.contentEditable)){var e=t.children;if(null!=e&&1===e.length&&"<"===e[0].tag){var r=e[0].children;t.dom.innerHTML!==r&&(t.dom.innerHTML=r)}else if(null!=t.text||null!=e&&0!==e.length)throw new Error("Child node of a contenteditable must be trusted");return 1}}function L(t,e,r,n){for(var s=r;s<n;s++){var i=e[s];null!=i&&R(t,i)}}function R(t,e){var r,n,s,i,o=0,a=e.state;function l(){u(e,a),k(e),c(t,e)}"string"!=typeof e.tag&&"function"==typeof e.state.onbeforeremove&&null!=(s=g.call(e.state.onbeforeremove,e))&&"function"==typeof s.then&&(o=1,r=s),e.attrs&&"function"==typeof e.attrs.onbeforeremove&&null!=(s=g.call(e.attrs.onbeforeremove,e))&&"function"==typeof s.then&&(o|=2,n=s),u(e,a),o?(null!=r&&(i=function(){1&o&&((o&=2)||l())},r.then(i,i)),null!=n&&(i=function(){2&o&&((o&=1)||l())},n.then(i,i))):(k(e),c(t,e))}function _(t,e){for(var r=0;r<e.instance.length;r++)t.removeChild(e.instance[r])}function c(t,e){for(;null!=e.dom&&e.dom.parentNode===t;){if("string"!=typeof e.tag){if(null!=(e=e.instance))continue}else if("<"===e.tag)_(t,e);else{if("["!==e.tag&&(t.removeChild(e.dom),!Array.isArray(e.children)))break;if(1===e.children.length){if(null!=(e=e.children[0]))continue}else for(var r=0;r<e.children.length;r++){var n=e.children[r];null!=n&&c(t,n)}}break}}function k(t){if("string"!=typeof t.tag&&"function"==typeof t.state.onremove&&g.call(t.state.onremove,t),t.attrs&&"function"==typeof t.attrs.onremove&&g.call(t.attrs.onremove,t),"string"!=typeof t.tag)null!=t.instance&&k(t.instance);else{var e=t.children;if(Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];null!=n&&k(n)}}}function w(t,e,r,n,s){if("key"!==e&&"is"!==e&&null!=n&&!S(e)&&(r!==n||(i=t,"value"===(o=e)||"checked"===o||"selectedIndex"===o||"selected"===o&&i.dom===f()||"option"===i.tag&&i.dom.parentNode===d.activeElement)||"object"==typeof n)){var i,o;if("o"===e[0]&&"n"===e[1])return I(t,e,n),0;if("xlink:"===e.slice(0,6))t.dom.setAttributeNS("http://www.w3.org/1999/xlink",e.slice(6),n);else if("style"===e)A(t.dom,r,n);else if(C(t,e,s)){if("value"===e){if(("input"===t.tag||"textarea"===t.tag)&&t.dom.value===""+n&&t.dom===f())return;if("select"===t.tag&&null!==r&&t.dom.value===""+n)return;if("option"===t.tag&&null!==r&&t.dom.value===""+n)return}"input"===t.tag&&"type"===e?t.dom.setAttribute(e,n):t.dom[e]=n}else"boolean"==typeof n?n?t.dom.setAttribute(e,""):t.dom.removeAttribute(e):t.dom.setAttribute("className"===e?"class":e,n)}}function S(t){return"oninit"===t||"oncreate"===t||"onupdate"===t||"onremove"===t||"onbeforeremove"===t||"onbeforeupdate"===t}function C(t,e,r){return void 0===r&&(-1<t.tag.indexOf("-")||null!=t.attrs&&t.attrs.is||"href"!==e&&"list"!==e&&"form"!==e&&"width"!==e&&"height"!==e)&&e in t.dom}function o(t){return"-"+t.toLowerCase()}function a(t){return"-"===t[0]&&"-"===t[1]?t:"cssFloat"===t?"float":t.replace(r,o)}function A(t,e,r){if(e!==r)if(null==r)t.style.cssText="";else if("object"!=typeof r)t.style.cssText=r;else if(null==e||"object"!=typeof e)for(var n in t.style.cssText="",r)null!=(s=r[n])&&t.style.setProperty(a(n),String(s));else{for(var n in r){var s;null!=(s=r[n])&&(s=String(s))!==String(e[n])&&t.style.setProperty(a(n),s)}for(var n in e)null!=e[n]&&null==r[n]&&t.style.removeProperty(a(n))}}function D(){this._=l}function I(t,e,r){null!=t.events?t.events[e]!==r&&(null==r||"function"!=typeof r&&"object"!=typeof r?(null!=t.events[e]&&t.dom.removeEventListener(e.slice(2),t.events,!1),t.events[e]=void 0):(null==t.events[e]&&t.dom.addEventListener(e.slice(2),t.events,!1),t.events[e]=r)):null==r||"function"!=typeof r&&"object"!=typeof r||(t.events=new D,t.dom.addEventListener(e.slice(2),t.events,!1),t.events[e]=r)}function $(t,e,r){"function"==typeof t.oninit&&g.call(t.oninit,e),"function"==typeof t.oncreate&&r.push(g.bind(t.oncreate,e))}function F(t,e,r){"function"==typeof t.onupdate&&r.push(g.bind(t.onupdate,e))}var M=n,B=function(){var t,e=arguments[this],r=this+1;if(null==e?e={}:"object"==typeof e&&null==e.tag&&!Array.isArray(e)||(e={},r=this),arguments.length===r+1)t=arguments[r],Array.isArray(t)||(t=[t]);else for(t=[];r<arguments.length;)t.push(arguments[r++]);return M("",e.key,e,t)},j=n,V=B,Q=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,U={},H={}.hasOwnProperty;function G(t){for(var e in t)if(H.call(t,e))return;return 1}var X=n,Y=function(t){return X("<",void 0,void 0,t=null==t?"":t,void 0,void 0)},J=n,W=B,Z=function(t){if(null==t||"string"!=typeof t&&"function"!=typeof t&&"function"!=typeof t.view)throw Error("The selector must be either a string or a component.");var e=V.apply(1,arguments);return"string"==typeof t&&(e.children=j.normalizeChildren(e.children),"["!==t)?function(t,e){var r=e.attrs,n=j.normalizeChildren(e.children),s=H.call(r,"class"),i=s?r.class:r.className;if(e.tag=t.tag,e.attrs=null,e.children=void 0,!G(t.attrs)&&!G(r)){var o,a={};for(o in r)H.call(r,o)&&(a[o]=r[o]);r=a}for(o in t.attrs)H.call(t.attrs,o)&&"className"!==o&&!H.call(r,o)&&(r[o]=t.attrs[o]);for(o in null==i&&null==t.attrs.className||(r.className=null!=i?null!=t.attrs.className?String(t.attrs.className)+" "+String(i):i:null!=t.attrs.className?t.attrs.className:null),s&&(r.class=null),r)if(H.call(r,o)&&"key"!==o){e.attrs=r;break}return Array.isArray(n)&&1===n.length&&null!=n[0]&&"#"===n[0].tag?e.text=n[0].children:e.children=n,e}(U[t]||function(t){for(var e,r="div",n=[],s={};e=Q.exec(t);){var i=e[1],o=e[2];""===i&&""!==o?r=o:"#"===i?s.id=o:"."===i?n.push(o):"["===e[3][0]&&(o=(o=e[6])&&o.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\"),"class"===e[4]?n.push(o):s[e[4]]=""===o?o:o||!0)}return 0<n.length&&(s.className=n.join(" ")),U[t]={tag:r,attrs:s}}(t),e):(e.tag=t,e)};Z.trust=Y,Z.fragment=function(){var t=W.apply(0,arguments);return t.tag="[",t.children=J.normalizeChildren(t.children),t};var q=Z;const K=q;const tt=i,et=function(t){let e=t.path,r=[];return e.forEach(function(t){t.path?(r.push(K("a",{href:"#"+t.path},t.title)),r.push(" / ")):r.push(K("b",t.title))}),0<r.length?K("nav",r):[]};var rt=class{constructor(t){this._element=t,this._element.className="header"}setDelegate(t){this._delegate=t}reload(){var t=et({path:this._delegate.getPathComponents()});tt(this._element,t)}};const nt=Y;const st=i,it=function(){let t=[];return t.push("<section>","<p><b>Grammophone</b> is a tool for analyzing and transforming context-free grammars. To start, type a grammar in the box to the left and click Analyze or Transform.</p>","<p>Grammars are written like this:</p>","<pre>S -> a S b .\nS -> .</pre>","<p>This grammar generates the language a<sup>n</sup>&nbsp;b<sup>n</sup>, where n&nbsp;≥&nbsp;0.</p>","</section>"),nt(t.join(""))};var ot=class{constructor(t){this._element=t,this._element.className="blank-slate"}setDelegate(t){this._delegate=t}reload(){var t=it();st(this._element,t)}},at={},lt="Grammar.END";const ht=q,ut=lt,ct="′";function ft(t){return t.replace(/'/g,ct)}function dt(t,e){if(t==ut)return ht("u","$");if(e.nonterminals.has(t))return ht("i",ft(t));if(e.terminals.has(t))return ht("b",ft(t));throw new Error("Unknown symbol: "+t)}const pt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function mt(t){return pt[t]}function gt(t){return t.replace(/[&<>"]/g,mt)}function vt(t,e){if(t==ut)return"$";if(e.nonterminals.has(t)||e.terminals.has(t))return gt(t).replace(/'/g,"&prime;");throw new Error("Unknown symbol: "+t)}function bt(e,r){let n=[];for(let t=0;t<e.length;t++)n.push(vt(e[t],r));return n}const xt={expand:function(t,e,r){return"Expand Nonterminal"},removeImmediateLeftRecursion:function(t,e,r){return"Remove Immediate Left Recursion"},leftFactor:function(t,e,r){return"Left Factor "+bt(e[t.production].slice(1,t.length+1),r).join(" ")},epsilonSeparate:function(t,e,r){return"Epsilon-Separate"},removeUnreachable:function(t,e,r){return"Remove Unreachable Nonterminal"}};at.fillArray=function(e,r){let n=[];for(let t=0;t<e;t++)n.push(r);return n},at.listSymbols=function(e,r){let n=[];for(let t=0;t<r.length;t++)e.has(r[t])&&n.push(r[t]);return e.has(ut)&&n.push(ut),n},at.formatSymbolList=function(e,r,n){void 0===n&&(n=", ");let s=[];for(let t=0;t<e.length;t++)0<t&&s.push(n),s.push(dt(e[t],r));return s},at.formatSymbol=dt,at.formatProduction=function(t,r){let n=[];return n.push(dt(t[0],r)),n.push(" "),n.push("→"),n.push(" "),1<t.length?t.slice(1).forEach(function(t,e){0<e&&n.push(" "),n.push(dt(t,r))}):n.push(ht("u","ε")),n},at.formatSentence=function(t,r){let n=[];return 0===t.length?n.push(ht("u","ε")):t.forEach(function(t,e){0<e&&n.push(" "),n.push(dt(t,r))}),n},at.escapeString=gt,at.bareFormatSymbol=vt,at.bareFormatSymbols=bt,at.bareFormatItem=function(e,t,r,n){let s;if(-1===e.production)s=0===e.index?"&bull; "+vt(t,n):vt(t,n)+" &bull;";else{let t=bt(r[e.production].slice(1),n);t.splice(e.index,0,"&bull;"),s=vt(r[e.production][0],n)+" &rarr; "+t.join(" ")}return e.lookaheads?"["+s+", "+bt(e.lookaheads,n).join(" / ")+"]":e.lookahead?"["+s+", "+vt(e.lookahead,n)+"]":s},at.formatTransformation=function(t,e,r){return xt[t.name](t,e,r)||t.name};var yt={};yt.any=function(t){return 0<t.size},yt.intersection=function(t,e){let r=new Set;for(var n of t.values())e.has(n)&&r.add(n);return r};const _t=q,kt=at,wt=yt;const St=i,Ct=function(t){var e=t.unreachable,r=t.unrealizable,n=t.cycle,s=t.nullAmbiguity,i=t.ambiguous,o=t.productions,a=t.info;return[_t("h1","Sanity Checks"),_t("ul.symbols",(t=e,e=a,wt.any(t)?_t("li","The grammar has unreachable nonterminals: ",kt.formatSymbolList(kt.listSymbols(t,e.productionOrder),e)):_t("li","All nonterminals are reachable.")),(e=r,r=a,wt.any(e)?_t("li","The grammar has unrealizable nonterminals: ",kt.formatSymbolList(kt.listSymbols(e,r.productionOrder),r)):_t("li","All nonterminals are realizable.")),(r=a,void 0!==(n=n)?_t("li","The grammar is cyclic: ",kt.formatSymbolList(n,r," ⇒ ")," is a cycle."):_t("li","The grammar contains no cycles.")),(r=o,o=a,0<(s=s).length?_t("li","The grammar contains a null ambiguity: ",kt.formatProduction(r[s[0]],o)," and ",kt.formatProduction(r[s[1]],o)," are ambiguously nullable."):_t("li","The grammar is null unambiguous.")),function(t,e){if(void 0!==t)return _t("li","The grammar is ambiguous: the sentence ",kt.formatSentence(t,e)," has an ambiguous derivation.")}(i,a))]},At=q,Pt=at;var Et=function(t){let e=t.sentences,r=t.info;var n=t.limit;let s=100,i=100,o=[];o.push(At("h1","Example Sentences"));var a={marginRight:"10px"},l={marginRight:"5px"};return o.push(At("label",{style:a},[At("span",{style:l},"Max depth"),At("input",{type:"number",placeholder:"Max depth",onchange:function(t){i=t.target.valueAsNumber}})])),o.push(At("label",{style:a},[At("span",{style:l},"Max sentences"),At("input",{type:"number",placeholder:"Max sentences",onchange:function(t){s=t.target.valueAsNumber}})])),o.push(At("button",{onclick:function(){t.onCalculate({maxSentences:s,maxDepth:i})}},"Calculate")),0<e.length?(o.push(At("ul.symbols",e.slice(0,n).map(function(t){return At("li",{style:{whiteSpace:"nowrap"}},Pt.formatSentence(t,r))}))),e.length>n&&o.push(At("p",At("a",{href:"#/sentences"},"More example sentences")))):o.push(At("p","No example sentences could be generated.")),o};const Ot=i,Tt=Et,Nt=i,zt=Et,Lt=q,Rt=at;const Dt=i,It=function(t){let n=t.nullable,s=t.endable,i=t.first,o=t.follow,a=t.info;return[Lt("h1","Nonterminals"),Lt("table.symbols",Lt("tr",Lt("th","Symbol"),Lt("th","Nullable?"),Lt("th","Endable?"),Lt("th","First set"),Lt("th","Follow set")),a.productionOrder.map(function(t){var e=i.get(t),r=o.get(t);return Lt("tr",Lt("td",Rt.formatSymbol(t,a)),Lt("td",n.has(t)?"Nullable":""),Lt("td",s.has(t)?"Endable":""),Lt("td",Rt.formatSymbolList(Rt.listSymbols(e,a.terminalOrder),a)),Lt("td",Rt.formatSymbolList(Rt.listSymbols(r,a.terminalOrder),a)))}))]},$t=q,Ft="—";function Mt(t,e,r){return t[e].member?["The grammar is ",r,"."]:$t("span",{className:"conflict"},"Not ",r," ",Ft," ",t[e].reason,".")}const Bt=i,jt=function(t){t=t.classification;return[$t("h1","Parsing Algorithms"),$t("table.parsing-algorithm-table",$t("tr",$t("th",{scope:"row"},"LL(1)"),$t("td.classification",Mt(t,"ll1","LL(1)")),$t("td",$t("a",{href:"#/ll1-table"},"Parsing table"))),$t("tr",$t("th",{scope:"row"},"LR(0)"),$t("td.classification",Mt(t,"lr0","LR(0)")),$t("td",$t("a",{href:"#/lr0-automaton"},"Automaton"),", ",$t("a",{href:"#/lr0-table"},"Parsing table"))),$t("tr",$t("th",{scope:"row"},"SLR(1)"),$t("td.classification",Mt(t,"slr1","SLR(1)")),$t("td",$t("a",{href:"#/slr1-table"},"Parsing table"))),$t("tr",$t("th",{scope:"row"},"LR(1)"),$t("td.classification",Mt(t,"lr1","LR(1)")),$t("td",$t("a",{href:"#/lr1-automaton"},"Automaton"),", ",$t("a",{href:"#/lr1-table"},"Parsing table"))),$t("tr",$t("th",{scope:"row"},"LALR(1)"),$t("td.classification",Mt(t,"lalr1","LALR(1)")),$t("td",$t("a",{href:"#/lalr1-automaton"},"Automaton"),", ",$t("a",{href:"#/lalr1-table"},"Parsing table"))))]},Vt=q,Qt=lt,Ut=at;const Ht=i,Gt=function(t){let r=t.info,n=t.table,s=t.productions;return Vt("table.symbols.ll1-table",Vt("colgroup",Vt("col")),Vt("colgroup.t",Ut.fillArray(r.terminals.size+1,Vt("col"))),Vt("tr",Vt("th"),r.terminalOrder.map(function(t){return Vt("th",Ut.formatSymbol(t,r))}),Vt("th",Ut.formatSymbol(Qt,r))),r.productionOrder.map(function(e){return Vt("tr",Vt("th",{scope:"row"},Ut.formatSymbol(e,r)),r.terminalOrder.concat(Qt).map(function(t){return void 0!==n[e][t]?Vt("td",{className:1<n[e][t].length?"conflict":""},Vt("ul",n[e][t].map(function(t){return Vt("li",Ut.formatProduction(s[t],r))}))):Vt("td")}))}))},Xt=at;var Yt=function(n){let r=n.info,t=n.automaton,s=n.productions,i=n.start;var e=n.title;let o=[];return o.push('digraph "',e,'" {\n  graph [rankdir=LR];\n  node [shape=record];\n'),t.forEach(function(t,e){o.push("  s",e,' [label="',e," | ",t.items.map(function(t){return Xt.bareFormatItem(t,i,s,r)}).join("\\n"),'"];\n')}),t.forEach(function(t,e){for(var r in t.transitions)o.push("  s",e," -> s",t.transitions[r],' [label="',Xt.bareFormatSymbol(r,n.info),'"];\n')}),o.push("}\n"),o.join("")};const Jt=Yt,Wt=q,Zt=at;const qt=i,Kt=function(t){let n=t.info,e=t.table,s=t.productions;return Wt("table.symbols.lr0-table",Wt("colgroup",Wt("col")),Wt("colgroup.t",Zt.fillArray(n.terminals.size,Wt("col"))),Wt("colgroup.nt",Zt.fillArray(n.nonterminals.size,Wt("col"))),Wt("tr",Wt("th","State"),n.terminalOrder.map(function(t){return Wt("th",Zt.formatSymbol(t,n))}),n.nonterminalOrder.map(function(t){return Wt("th",Zt.formatSymbol(t,n))})),e.map(function(r,t){return Wt("tr",Wt("th",{scope:"row"},t),n.terminalOrder.map(function(t){let e=[];void 0!==r.shift[t]&&e.push(Wt("li","shift(",r.shift[t],")")),r.reduce.forEach(function(t){-1===t?e.push(Wt("li","accept")):e.push(Wt("li","reduce(",Zt.formatProduction(s[t],n),")"))});t=1<(void 0===r.shift[t]?0:1)+r.reduce.length;return Wt("td",{className:t?"conflict":""},Wt("ul",e))}),n.nonterminalOrder.map(function(t){return Wt("td",Wt("ul",void 0!==r.shift[t]?Wt("li",r.shift[t]):[]))}))}))},te=q,ee=lt,re=at;var ne=function(t){let n=t.info,e=t.table,s=t.productions;return te("table.symbols.lr1-table",te("colgroup",te("col")),te("colgroup.t",re.fillArray(n.terminals.size+1,te("col"))),te("colgroup.nt",re.fillArray(n.nonterminals.size,te("col"))),te("tr",te("th","State"),n.terminalOrder.map(function(t){return te("th",re.formatSymbol(t,n))}),te("th",re.formatSymbol(ee,n)),n.nonterminalOrder.map(function(t){return te("th",re.formatSymbol(t,n))})),e.map(function(r,t){return te("tr",te("th",{scope:"row"},t),n.terminalOrder.concat(ee).map(function(t){if(void 0===r[t])return te("td");{let e=[];void 0!==r[t].shift&&e.push(te("li","shift(",r[t].shift,")")),void 0!==r[t].reduce&&r[t].reduce.forEach(function(t){-1===t?e.push(te("li","accept")):e.push(te("li","reduce(",re.formatProduction(s[t],n),")"))});t=1<(void 0===r[t].shift?0:1)+(void 0!==r[t].reduce?r[t].reduce.length:0);return te("td",{className:t?"conflict":""},te("ul",e))}}),n.nonterminalOrder.map(function(t){return void 0===r[t]?te("td"):void 0===r[t].shift?te("td",te("ul")):te("td",te("ul",te("li",r[t].shift)))}))}))};const se=i,ie=ne,oe=Yt,ae=i,le=ne,he=Yt,ue=i,ce=ne;var fe=rt,de=ot,pe=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}reload(){var t=Ct({unreachable:this._delegate.getCalculation("grammar.unreachable"),unrealizable:this._delegate.getCalculation("grammar.unrealizable"),cycle:this._delegate.getCalculation("grammar.cycle"),nullAmbiguity:this._delegate.getCalculation("grammar.nullAmbiguity"),ambiguous:this._delegate.getCalculation("grammar.ambiguous"),productions:this._delegate.getCalculation("grammar.productions"),info:this._delegate.getCalculation("grammar.symbolInfo")});St(this._element,t)}},me=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}reload(t={}){window.console.log("reloading with params: ",t);t=Tt({sentences:this._delegate.getCalculation("grammar.sentences",t),info:this._delegate.getCalculation("grammar.symbolInfo"),onCalculate:t=>this.reload(t)});Ot(this._element,t)}},ge=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}reload(t={}){t=zt({sentences:this._delegate.getCalculation("grammar.sentences",t),info:this._delegate.getCalculation("grammar.symbolInfo"),onCalculate:t=>this.reload(t),limit:10});Nt(this._element,t)}},ve=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}reload(){var t=It({nullable:this._delegate.getCalculation("grammar.nullable"),endable:this._delegate.getCalculation("grammar.endable"),first:this._delegate.getCalculation("grammar.first"),follow:this._delegate.getCalculation("grammar.follow"),info:this._delegate.getCalculation("grammar.symbolInfo")});Dt(this._element,t)}},be=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}reload(){var t=jt({classification:this._delegate.getCalculation("grammar.classification")});Bt(this._element,t)}},xe=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}reload(){var t=Gt({info:this._delegate.getCalculation("grammar.symbolInfo"),table:this._delegate.getCalculation("parsing.ll.ll1_table"),productions:this._delegate.getCalculation("grammar.productions")});Ht(this._element,t)}},ye=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}reload(){var t=Jt({info:this._delegate.getCalculation("grammar.symbolInfo"),automaton:this._delegate.getCalculation("parsing.lr.lr0_automaton"),productions:this._delegate.getCalculation("grammar.productions"),start:this._delegate.getCalculation("grammar.start"),title:"LR(0) Automaton"});this._element.innerHTML=Viz(t)}},_e=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}reload(){var t=Kt({info:this._delegate.getCalculation("grammar.symbolInfo"),table:this._delegate.getCalculation("parsing.lr.lr0_table"),productions:this._delegate.getCalculation("grammar.productions")});qt(this._element,t)}},ke=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}reload(){var t=ie({info:this._delegate.getCalculation("grammar.symbolInfo"),table:this._delegate.getCalculation("parsing.lr.slr1_table"),productions:this._delegate.getCalculation("grammar.productions")});se(this._element,t)}},we=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}reload(){var t=oe({info:this._delegate.getCalculation("grammar.symbolInfo"),automaton:this._delegate.getCalculation("parsing.lr.lr1_automaton"),productions:this._delegate.getCalculation("grammar.productions"),start:this._delegate.getCalculation("grammar.start"),title:"LR(1) Automaton"});this._element.innerHTML=Viz(t)}},Se=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}reload(){var t=le({info:this._delegate.getCalculation("grammar.symbolInfo"),table:this._delegate.getCalculation("parsing.lr.lr1_table"),productions:this._delegate.getCalculation("grammar.productions")});ae(this._element,t)}},Ce=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}reload(){var t=he({info:this._delegate.getCalculation("grammar.symbolInfo"),automaton:this._delegate.getCalculation("parsing.lr.lalr1_automaton"),productions:this._delegate.getCalculation("grammar.productions"),start:this._delegate.getCalculation("grammar.start"),title:"LALR(1) Automaton"});this._element.innerHTML=Viz(t)}},Ae=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}reload(){var t=ce({info:this._delegate.getCalculation("grammar.symbolInfo"),table:this._delegate.getCalculation("parsing.lr.lalr1_table"),productions:this._delegate.getCalculation("grammar.productions")});ue(this._element,t)}},Pe=class{constructor(t){this._element=t,this._element.id="analysis",this._blankSlateElement=document.createElement("section"),this._element.appendChild(this._blankSlateElement),this._blankSlateView=new de(this._blankSlateElement),this._blankSlateView.setDelegate(this),this._headerElement=document.createElement("header"),this._element.appendChild(this._headerElement),this._headerView=new fe(this._headerElement),this._headerView.setDelegate(this),this._routes={"/":{views:[{id:"sanity",constructor:pe},{id:"sentences",constructor:ge},{id:"nonterminals",constructor:ve},{id:"parsing",constructor:be}],path:[{title:"Analysis"}]},"/ll1-table":{views:[{id:"table",constructor:xe}],path:[{path:"/",title:"Analysis"},{title:"LL(1) Parsing Table"}]},"/lr0-automaton":{views:[{id:"automaton",constructor:ye}],path:[{path:"/",title:"Analysis"},{title:"LR(0) Automaton"}]},"/lr0-table":{views:[{id:"table",constructor:_e}],path:[{path:"/",title:"Analysis"},{title:"LR(0) Parsing Table"}]},"/slr1-table":{views:[{id:"table",constructor:ke}],path:[{path:"/",title:"Analysis"},{title:"SLR(1) Parsing Table"}]},"/lr1-automaton":{views:[{id:"automaton",constructor:we}],path:[{path:"/",title:"Analysis"},{title:"LR(1) Automaton"}]},"/lr1-table":{views:[{id:"table",constructor:Se}],path:[{path:"/",title:"Analysis"},{title:"LR(1) Parsing Table"}]},"/lalr1-automaton":{views:[{id:"automaton",constructor:Ce}],path:[{path:"/",title:"Analysis"},{title:"LALR(1) Automaton"}]},"/lalr1-table":{views:[{id:"table",constructor:Ae}],path:[{path:"/",title:"Analysis"},{title:"LALR(1) Parsing Table"}]},"/sentences":{views:[{id:"sentences",constructor:me}],path:[{path:"/",title:"Analysis"},{title:"Example Sentences"}]}},this._views=[]}setDelegate(t){this._delegate=t}reload(){var t,e;if(this._grammar=this._delegate.getGrammar(),e=(t=this._delegate.getPath())!==this._path,this._path=t,0<this._views.length){for(n=0;n<this._views.length;n++)this._views[n].instance.teardown&&this._views[n].instance.teardown(),this._element.removeChild(this._views[n].element);this._views=[]}if(void 0!==this._grammar){for(var r=this._routes[this._path],n=0;n<r.views.length;n++){var s=document.createElement("article");s.id=r.views[n].id,this._element.appendChild(s);var i=new r.views[n].constructor(s);i.setDelegate(this),i.setup&&i.setup(),i.reload&&i.reload(),this._views[n]={instance:i,element:s}}this._headerElement.style.display="",this._blankSlateElement.style.display="none"}else this._headerElement.style.display="none",this._blankSlateElement.style.display="";this._headerView.reload(),this._blankSlateView.reload(),e&&(this._element.scrollLeft=0,this._element.scrollTop=0)}getCalculation(t,e={}){return this._grammar.calculate(t,e)}getPathComponents(){return this._routes[this._path].path}};const Ee=q;const Oe=i,Te=function(t){t=t.spec;return Ee("div.spec-wrap",Ee("textarea.spec",{value:t}))};var Ne=class{constructor(t){this._element=t,this._element.id="edit"}getSpec(){return this._element.querySelector(".spec").value}setDelegate(t){this._delegate=t}reload(){var t=Te({spec:this._delegate.getSpec()});Oe(this._element,t)}};const ze=q,Le=at,Re=at.formatTransformation;const De=i,Ie=function(t){let s=t.productions,i=t.info;var e=t.undoTransformation,r=t.redoTransformation,n=t.transformations;let o=[];void 0!==e&&o.push(ze("button.undo",{"data-action":"undo"},"Undo ",Re(e,s,i))),void 0!==r&&o.push(ze("button.redo",{"data-action":"redo"},"Redo ",Re(r,s,i)));let a=[];for(let e=0;e<s.length;e++){a[e]=[];for(let t=0;t<s[e].length;t++)a[e][t]=[]}for(let t=0;t<n.length;t++){var l=n[t];a[l.production][l.symbol].push({index:t,transformation:l})}return[ze("div.buttons",o),ze("table.symbols.productions",s.map(function(t,r){let n=[];return t.forEach(function(t,e){0<e&&n.push(" "),0<a[r][e].length?n.push(ze("span.pill",Le.formatSymbol(t,i),ze("select",ze("option",{disabled:!0,selected:!0},t),a[r][e].map(function(t){return ze("option",{value:t.index},Re(t.transformation,s,i))})))):n.push(Le.formatSymbol(t,i)),0===e&&(n.push(" "),n.push("→"))}),1===t.length&&(n.push(" "),n.push(ze("u","ε"))),ze("tr",ze("td",n))}))]};var $e=class{constructor(t){this._element=t}setDelegate(t){this._delegate=t}setup(){this._element.addEventListener("click",function(t){"undo"===t.target.dataset.action?this._delegate.undo():"redo"===t.target.dataset.action&&this._delegate.redo()}.bind(this)),this._element.addEventListener("change",function(t){t=parseInt(t.target.value);this._delegate.transform(this._transformations[t])}.bind(this))}reload(){this._transformations=this._delegate.getTransformations();var t=Ie({productions:this._delegate.getProductions(),info:this._delegate.getSymbolInfo(),undoTransformation:this._delegate.getUndoTransformation(),redoTransformation:this._delegate.getRedoTransformation(),transformations:this._transformations});De(this._element,t)}},Fe=class{constructor(t){this._element=t,this._element.id="transform",this._transformElement=document.createElement("article"),this._element.appendChild(this._transformElement),this._transformView=new $e(this._transformElement),this._transformView.setDelegate(this),this._transformView.setup&&this._transformView.setup()}setDelegate(t){this._delegate=t}reload(){this._index=0,this._stack=[{grammar:this._delegate.getGrammar()}],this._transformView.reload()}getProductions(){return this._stack[this._index].grammar.productions}getSymbolInfo(){return this._stack[this._index].grammar.calculate("grammar.symbolInfo")}getPreviousSymbolInfo(){if(0<this._index)return this._stack[this._index-1].grammar.calculate("grammar.symbolInfo")}getTransformations(t,e){return this._stack[this._index].grammar.calculate("transformations.all")}getUndoTransformation(){if(0<this._index)return this._stack[this._index].transformation}getRedoTransformation(){if(this._index<this._stack.length-1)return this._stack[this._index+1].transformation}undo(){0<this._index&&this._index--,this._transformView.reload(),this._delegate.grammarChanged(this._stack[this._index].grammar)}redo(){this._index<this._stack.length-1&&this._index++,this._transformView.reload(),this._delegate.grammarChanged(this._stack[this._index].grammar)}transform(t){t={grammar:this._stack[this._index].grammar.transform(t),transformation:t};this._index++,this._stack.splice(this._index,this._stack.length-this._index,t),this._transformView.reload(),this._delegate.grammarChanged(this._stack[this._index].grammar)}};const Me=q;const Be=i,je=function(t){t=t.mode;return[Me("input#mode-edit",{type:"radio",name:"mode",value:"edit",checked:"edit"===t}),Me("label.left",{for:"mode-edit"},"Edit"),Me("input#mode-transform",{type:"radio",name:"mode",value:"transform",checked:"transform"===t}),Me("label.right",{for:"mode-transform"},"Transform"),Me("button#mode-analyze",{disabled:"edit"!==t},"Analyze")]};function Ve(t){return{ll1:t.calculate("parsing.ll.ll1_classification"),lr0:t.calculate("parsing.lr.lr0_classification"),slr1:t.calculate("parsing.lr.slr1_classification"),lr1:t.calculate("parsing.lr.lr1_classification"),lalr1:t.calculate("parsing.lr.lalr1_classification")}}function Qe(t){for(var e=new Set,r=0;r<t.productions.length;r++)e.add(t.productions[r][0]);return e}function Ue(t){for(var e,r=new Set,n=t.calculate("grammar.nonterminals"),s=0;s<t.productions.length;s++)for(e=1;e<t.productions[s].length;e++)n.has(t.productions[s][e])||r.add(t.productions[s][e]);return r}function He(t){for(var e,r,n=[],s=[],i=[],o=t.calculate("grammar.nonterminals"),a=t.calculate("grammar.terminals"),l=0;l<t.productions.length;l++)for(r=t.productions[l][0],-1===i.indexOf(r)&&i.push(r),e=0;e<t.productions[l].length;e++)r=t.productions[l][e],o.has(r)&&-1===s.indexOf(r)&&s.push(r),a.has(r)&&-1===n.indexOf(r)&&n.push(r);return{terminalOrder:n,nonterminalOrder:s,productionOrder:i,nonterminals:o,terminals:a}}function Ge(t){return t.productions[0][0]}function Xe(t){return t.productions}var Ye=class{constructor(t){this._element=t,this._element.id="mode",this._element.addEventListener("change",function(t){"edit"===t.target.value?this._delegate.edit():"transform"===t.target.value&&this._delegate.transform()}.bind(this)),this._element.addEventListener("click",function(t){"mode-analyze"===t.target.id&&this._delegate.analyze()}.bind(this))}setDelegate(t){this._delegate=t}reload(){var t=je({mode:this._delegate.getMode()});Be(this._element,t)}},Je=class{constructor(t){this._element=t,this._element.id="error"}setDelegate(t){this._delegate=t}reload(){var t=this._delegate.getError();this._element.innerHTML=void 0!==t?"<code>"+this._delegate.getError()+"</code>":""}},We={exports:{}};class Ze{constructor(t){if(this._map=new Map,null!=t)for(var[e,r]of t)this.add(e,r)}has(t,e){return!!this._map.has(t)&&this._map.get(t).has(e)}get(t){return this._map.has(t)?this._map.get(t):new Set}keys(){return this._map.keys()}*[Symbol.iterator](){for(var t of this._map.keys())for(var e of this._map.get(t))yield[t,e]}entries(){return this[Symbol.iterator]()}add(t,e){this._map.has(t)||this._map.set(t,new Set),this._map.get(t).add(e)}propagate(t){let e=new Ze,r=t.closure();for(var n of this.keys())for(var s of this.get(n))e.add(n,s);for(var i of r.keys())for(var o of r.get(i))for(var a of this.get(o))e.add(i,a);return e}closure(){var t,e,r=new Ze,n=new Set;for(t of this.keys()){n.add(t);for(var s of this.get(t))n.add(s),r.add(t,s)}for(e of n)for(var i of n)for(var o of n)(r.has(i,o)||r.has(i,e)&&r.has(e,o))&&r.add(i,o);return r}dfs(t,e){for(var r of this.get(t)){if(-1!=e.indexOf(r))return r==t?e.concat(t):e.concat(t).concat(r);r=this.dfs(r,e.concat(t));if(r)return r}}cycle(){for(var t of this.keys()){t=this.dfs(t,[]);if(t)return t}}}function qe(t){for(var e,r,n,s,i=t.calculate("grammar.nonterminals"),o=t.calculate("grammar.start"),a=new er,l=0;l<t.productions.length;l++)for(n=1;n<t.productions[l].length;n++)i.has(t.productions[l][n])&&a.add(t.productions[l][0],t.productions[l][n]);e=a.closure(),r=new Set;for(s of i)s==o||e.has(o,s)||r.add(s);return r}function Ke(t){var e,r,n,s,i,o=t.calculate("grammar.nonterminals"),a=new Set;do{for(e=[],n=0;n<t.productions.length;n++){for(s=1;s<t.productions[n].length&&(a.has(t.productions[n][s])||!o.has(t.productions[n][s]));s++);a.has(t.productions[n][0])||s!=t.productions[n].length||(a.add(t.productions[n][0]),e.push(t.productions[n][0]))}}while(0<e.length);r=new Set;for(i of o)a.has(i)||r.add(i);return r}var tr=Ze,er=tr;const rr=tr;function nr(t){for(var e,r,n=t.calculate("grammar.nonterminals"),s=t.calculate("grammar.nullable"),i=new rr,o=0;o<t.productions.length;o++)for(e=1;e<t.productions[o].length;e++)if(n.has(t.productions[o][e])){for(r=1;r<t.productions[o].length&&(e===r||n.has(t.productions[o][r])&&s.has(t.productions[o][r]));r++);r===t.productions[o].length&&i.add(t.productions[o][0],t.productions[o][e])}return i.cycle()}function sr(t){var e,r,n,s,i=t.calculate("grammar.nonterminals"),o=t.calculate("grammar.nullable");for(r of i)for(e=void 0,n=0;n<t.productions.length;n++)if(t.productions[n][0]==r)if(1!=t.productions[n].length){for(s=1;s<t.productions[n].length&&o.has(t.productions[n][s]);s++);if(s==t.productions[n].length){if(void 0!==e)return n<e?[n,e]:[e,n];e=n}}else{if(void 0!==e)return n<e?[n,e]:[e,n];e=n}return[]}function ir(t){var e,r,n,s,i=new Set;do{for(e=[],r=0;r<t.productions.length;r++){for(n=1;n<t.productions[r].length&&i.has(t.productions[r][n]);n++);s=t.productions[r][0],n!=t.productions[r].length||i.has(s)||(i.add(s),e.push(s))}}while(0<e.length);return i}function or(t){for(var e,r=t.calculate("grammar.nullable"),n=t.calculate("grammar.nonterminals"),s=new lr,i=new lr,o=0;o<t.productions.length;o++){for(e=1;e<t.productions[o].length&&r.has(t.productions[o][e]);e++);e<t.productions[o].length&&!n.has(t.productions[o][e])&&s.add(t.productions[o][0],t.productions[o][e])}for(o=0;o<t.productions.length;o++)for(e=1;e<t.productions[o].length&&(n.has(t.productions[o][e])&&i.add(t.productions[o][0],t.productions[o][e]),r.has(t.productions[o][e]));e++);return s.propagate(i)}function ar(t){var e,r,n,s,i=t.calculate("grammar.first"),o=t.calculate("grammar.nullable"),a=t.calculate("grammar.nonterminals"),l=t.calculate("grammar.start"),h=new hr,u=new hr;for(h.add(l,ur),e=0;e<t.productions.length;e++)for(r=1;r<t.productions[e].length-1;r++)if(a.has(t.productions[e][r]))for(n=r+1;n<t.productions[e].length;n++){if(!a.has(t.productions[e][n])){h.add(t.productions[e][r],t.productions[e][n]);break}for(s of i.get(t.productions[e][n]))h.add(t.productions[e][r],s);if(!o.has(t.productions[e][n]))break}for(e=0;e<t.productions.length;e++)for(r=t.productions[e].length-1;0<r&&(a.has(t.productions[e][r])&&u.add(t.productions[e][r],t.productions[e][0]),o.has(t.productions[e][r]));r--);return h.propagate(u)}var lr=tr,hr=tr,ur=lt;const cr=lt;function fr(t){var e,r=new Set,n=t.calculate("grammar.follow");for(e of n.keys())n.has(e,cr)&&r.add(e);return r}function dr(t,e={}){let r={maxSentences:100,maxDepth:200};e.maxSentences&&(r.maxSentences=e.maxSentences),e.maxDepth&&(r.maxDepth=e.maxDepth);var n,s,i=[],o=[{sentence:[t.calculate("grammar.start")],steps:0,nonterminals:1}];do{for(s=function(t,e){for(var r,n,s,i,o=[],a=e.calculate("grammar.nonterminals"),l=e.calculate("grammar.unrealizable"),h=0;h<t.sentence.length;h++)if(a.has(t.sentence[h])&&!l.has(t.sentence[h])){for(r=0;r<e.productions.length;r++)if(e.productions[r][0]===t.sentence[h]){for(s=e.productions[r].slice(1),n=i=0;n<s.length;n++)a.has(s[n])&&i++;o.push({sentence:t.sentence.slice(0,h).concat(s).concat(t.sentence.slice(h+1)),steps:t.steps+1,nonterminals:t.nonterminals-1+i})}break}return o}(o.shift(),t),n=0;n<s.length&&(0===s[n].nonterminals?i.push(s[n].sentence):o.push(s[n]),!(i.length>=r.maxSentences));n++);o=o.sort(function(t,e){return t.nonterminals+t.steps-(e.nonterminals+e.steps)})}while(0<o.length&&i.length<r.maxSentences&&o.length<r.maxDepth);return i.sort(function(t,e){return t.length===e.length?t<e:t.length-e.length})}function pr(t){for(var e,r=t.calculate("grammar.sentences"),n=0;n<r.length-1;n++)if(r[n].length==r[n+1].length){for(e=0;e<r[n].length&&r[n][e]===r[n+1][e];e++);if(e===r[n].length)return r[n]}}function mr(t){var e,r,n,s,i,o,a;if(0<t.calculate("grammar.nullAmbiguity").length)return{member:!1,reason:"it contains a null ambiguity"};var l=t.calculate("grammar.follow"),h=t.calculate("grammar.terminals"),u=t.calculate("grammar.nonterminals"),c=t.calculate("grammar.nullable"),f={};for(r of u){f[r]={};for(n of h)f[r][n]=!1}for(e=0;e<t.productions.length;e++){i=t.productions[e][0],o=t.productions[e].slice(1);for(s of a=t.getFirst(o)){if(f[i][s])return{member:!1,reason:"it contains a first set clash"};f[i][s]=!0}}a=t.calculate("grammar.first");for(r of c)if(br.any(br.intersection(a.get(r),l.get(r))))return{member:!1,reason:"it contains a first/follow set clash"};return{member:!0}}function gr(t){var e,r,n,s,i,o,a={},l=t.calculate("grammar.terminals"),h=t.calculate("grammar.nonterminals"),u=t.calculate("grammar.follow");for(r of h){a[r]={};for(n of l)a[r][n]=[];a[r][xr]=[]}for(e=0;e<t.productions.length;e++){i=t.productions[e][0],o=t.productions[e].slice(1);for(s of t.getFirst(o))a[i][s].push(e);if(t.isNullable(o))for(s of u.get(i))a[i][s].push(e)}return a}function vr(t){for(var e,r=t.calculate("parsing.lr.lr0_table"),n=t.calculate("grammar.terminals"),s=0;s<r.length;s++){if(1<r[s].reduce.length)return{member:!1,reason:"it contains a reduce-reduce conflict"};if(0<r[s].reduce.length)for(e in r[s].shift)if(n.has(e))return{member:!1,reason:"it contains a shift-reduce conflict"}}return{member:!0}}var br=yt,xr=lt,yr={};yr.automaton=function(t,e){for(var r,n,s,i,o,a,l=[{kernel:e.initial()}],h=0;h<l.length;)for(n=l.length;h<n;h++)for(i in(r=l[h]).items=e.closure(t,r.kernel),s=e.transitions(t,r.items),r.transitions={},s){for(o=s[i],a=0;a<l.length;a++)if(e.same(l[a].kernel,o)){r.transitions[i]=a;break}a===l.length&&(r.transitions[i]=l.length,l.push({kernel:o}))}return l},yr.classifyLR1=function(t){for(var e,r=0;r<t.length;r++)for(e in t[r]){if(void 0!==t[r][e].reduce&&1<t[r][e].reduce.length)return{member:!1,reason:"it contains a reduce-reduce conflict"};if(void 0!==t[r][e].shift&&void 0!==t[r][e].reduce&&0<t[r][e].reduce.length)return{member:!1,reason:"it contains a shift-reduce conflict"}}return{member:!0}},yr.addReduceAction=function(t,e,r){void 0===t[e]&&(t[e]={reduce:[]}),void 0===t[e].reduce&&(t[e].reduce=[]),t[e].reduce.push(r)},yr.collapseLookaheads=function(t){for(var e,r,n,s={},i=0;i<t.length;i++)e=t[i].production,r=t[i].index,n=t[i].lookahead,s[e]||(s[e]=[]),s[e][r]||(s[e][r]=[]),s[e][r].push(n);var o=[];for(e in s)for(r in s[e])o.push({production:parseInt(e),index:parseInt(r),lookaheads:s[e][r]});return o},yr.mergeItems=function(t,e){for(var r,n,s,i=[],o=0;o<t.length;o++){for(r={production:t[o].production,index:t[o].index,lookaheads:[]},n=0;n<t[o].lookaheads.length;n++)r.lookaheads.push(t[o].lookaheads[n]);for(n=0;n<e.length;n++)if(e[n].production==t[o].production&&e[n].index==t[o].index)for(s=0;s<e[n].lookaheads.length;s++)-1===r.lookaheads.indexOf(e[n].lookaheads[s])&&r.lookaheads.push(e[n].lookaheads[s]);i.push(r)}return i};function _r(t){return wr(t,Sr)}var kr={initial:function(){return[{production:-1,index:0}]},closure:function(t,e){for(var r,n,s,i,o=t.calculate("grammar.start"),a=new Set,l=[],h=0;h<e.length;h++)l.push({production:e[h].production,index:e[h].index});do{for(i=[],h=0;h<l.length;h++)for(s=-1===(n=l[h]).production?[o][n.index]:t.productions[n.production][n.index+1],r=0;r<t.productions.length;r++)a.has(r)||t.productions[r][0]!=s||(i.push({production:r,index:0}),a.add(r));for(h=0;h<i.length;h++)l.push(i[h])}while(0<i.length);return l},transitions:function(t,e){for(var r,n,s={},i=t.calculate("grammar.start"),o=0;o<e.length;o++)void 0!==(n=-1===(r=e[o]).production?[i][r.index]:t.productions[r.production][r.index+1])&&(s[n]||(s[n]=[]),s[n].push({production:r.production,index:r.index+1}));return s},same:function(t,e){var r,n;if(t.length!==e.length)return!1;for(r=0;r<t.length;r++){for(n=0;n<e.length&&(t[r].production!==e[n].production||t[r].index!==e[n].index);n++);if(n===e.length)return!1}return!0}},wr=yr.automaton,Sr=kr,n=function(t){for(var e,r,n,s,i,o=[],a=t.calculate("parsing.lr.lr0_automaton"),l=0;l<a.length;l++){for(r in i={shift:{},reduce:[]},(n=a[l]).transitions)i.shift[r]=n.transitions[r];for(e=0;e<n.items.length;e++)-1===(s=n.items[e]).production?1===s.index&&i.reduce.push(s.production):s.index==t.productions[s.production].length-1&&i.reduce.push(s.production);o.push(i)}return o},Cr=yr.classifyLR1,B=function(t){return Cr(t.calculate("parsing.lr.slr1_table"))},Ar=lt,Pr=yr.addReduceAction,Z=function(t){for(var e,r,n,s,i,o=[],a=t.calculate("parsing.lr.lr0_automaton"),l=t.calculate("grammar.follow"),h=0;h<a.length;h++){for(r in s={},(n=a[h]).transitions)s[r]={shift:n.transitions[r]};for(e=0;e<n.items.length;e++)if(-1===(i=n.items[e]).production)1===i.index&&Pr(s,Ar,i.production);else if(i.index==t.productions[i.production].length-1)for(r of l.get(t.productions[i.production][0]))Pr(s,r,i.production);o.push(s)}return o},Er=lt,Or=yr.automaton,Tr={initial:function(){return[{production:-1,index:0,lookahead:Er}]},closure:function(t,e){for(var r,n,s,i,o,a,l,h=t.calculate("grammar.start"),u={},c=0;c<t.productions.length;c++)u[c]={};var f=[];for(c=0;c<e.length;c++)f.push({production:e[c].production,index:e[c].index,lookahead:e[c].lookahead});do{for(l=[],c=0;c<f.length;c++)if(0!=(i=-1===(s=f[c]).production?[h].slice(s.index):t.productions[s.production].slice(s.index+1)).length)for(o=i[0],a=t.getFirst(i.slice(1).concat(s.lookahead)),r=0;r<t.productions.length;r++)if(t.productions[r][0]==o)for(n of a)u[r][n]||(l.push({production:r,index:0,lookahead:n}),u[r][n]=!0);for(c=0;c<l.length;c++)f.push(l[c])}while(0<l.length);return f},transitions:function(t,e){for(var r,n,s={},i=t.calculate("grammar.start"),o=0;o<e.length;o++)void 0!==(n=-1===(r=e[o]).production?[i][r.index]:t.productions[r.production][r.index+1])&&(s[n]||(s[n]=[]),s[n].push({production:r.production,index:r.index+1,lookahead:r.lookahead}));return s},same:function(t,e){var r,n;if(t.length!==e.length)return!1;for(r=0;r<t.length;r++){for(n=0;n<e.length&&(t[r].production!==e[n].production||t[r].index!==e[n].index||t[r].lookahead!==e[n].lookahead);n++);if(n===e.length)return!1}return!0}},Y=function(t){return Or(t,Tr)},Nr=yr.classifyLR1,Et=function(t){return Nr(t.calculate("parsing.lr.lr1_table"))},zr=lt,Lr=yr.addReduceAction,Yt=function(t){for(var e,r,n,s,i,o=[],a=t.calculate("parsing.lr.lr1_automaton"),l=0;l<a.length;l++){for(r in s={},(n=a[l]).transitions)s[r]={shift:n.transitions[r]};for(e=0;e<n.items.length;e++)-1===(i=n.items[e]).production?1===i.index&&Lr(s,zr,i.production):i.index==t.productions[i.production].length-1&&Lr(s,i.lookahead,i.production);o.push(s)}return o},Rr=yr.classifyLR1,ne=function(t){return Rr(t.calculate("parsing.lr.lalr1_table"))},Dr=yr.collapseLookaheads,Ir=kr,$r=yr.mergeItems,rt=function(t){for(var e=t.calculate("parsing.lr.lr1_automaton"),r=0;r<e.length;r++)e[r].kernel=Dr(e[r].kernel),e[r].items=Dr(e[r].items);var n=[],s=[];for(r=0;r<e.length;r++)if(!n[r]){for(var i=[],o=0;o<e.length;o++)!n[o]&&Ir.same(e[r].kernel,e[o].kernel)&&(i.push(o),n[o]=!0);s.push(i)}var a=[];for(r=0;r<s.length;r++)for(o=0;o<s[r].length;o++)a[s[r][o]]=r;var l=[];for(r=0;r<s.length;r++){var h={kernel:[],items:[],transitions:{}};for(o=0;o<s[r].length;o++)h.kernel=$r(e[s[r][o]].kernel,h.kernel),h.items=$r(e[s[r][o]].items,h.items);var u,c=e[s[r][0]].transitions;for(u in c)h.transitions[u]=a[c[u]];l.push(h)}return l},Fr=yr.addReduceAction,Mr=lt,ot=function(t){for(var e,r,n,s,i,o,a=[],l=t.calculate("parsing.lr.lalr1_automaton"),h=0;h<l.length;h++){for(n in i={},(s=l[h]).transitions)i[n]={shift:s.transitions[n]};for(e=0;e<s.items.length;e++)if(-1===(o=s.items[e]).production)1===o.index&&Fr(i,Mr,o.production);else if(o.index==t.productions[o.production].length-1)for(r=0;r<o.lookaheads.length;r++)Fr(i,o.lookaheads[r],o.production);a.push(i)}return a};at=function(t){for(var e,r=t.calculate("grammar.nonterminals"),n=[],s=0;s<t.productions.length;s++)for(e=1;e<t.productions[s].length;e++)r.has(t.productions[s][e])&&n.push({name:"expand",production:s,symbol:e,changes:function(t,e,r){var n=[];n.push({operation:"delete",index:e});for(var s,i,o=0,a=0;a<t.productions.length;a++)t.productions[a][0]===t.productions[e][r]&&(s=t.productions[e].slice(),i=t.productions[a].slice(1),Array.prototype.splice.apply(s,[r,1].concat(i)),n.push({production:s,operation:"insert",index:e+o}),o++);return n}(t,s,e)});return n};q=function(t){var e,r,n=[],s={};for(r of t.calculate("grammar.nonterminals"))s[r]={recursive:[],base:[]};for(e=0;e<t.productions.length;e++)((r=t.productions[e][0])==t.productions[e][1]?s[r].recursive:s[r].base).push(e);for(r in s)0<s[r].recursive.length&&0<s[r].base.length&&n.push({name:"removeImmediateLeftRecursion",production:s[r].recursive[0],symbol:0,changes:function(t,e,r){for(var n,s,i=t.calculate("grammar.nonterminals"),o=t.productions[r[0]][0];i.has(o+="'"););for(var a,l=[],h=0,u=0;u<t.productions.length;u++)-1===e.indexOf(u)&&-1===r.indexOf(u)||(l.push({index:u+h,operation:"delete"}),h--,void 0===a&&(a=u));for(u=h=0;u<e.length;u++){for(s=[],n=0;n<t.productions[e[u]].length;n++)s.push(t.productions[e[u]][n]);s.push(o),l.push({production:s,operation:"insert",index:a+h}),h++}for(u=0;u<r.length;u++){for((s=[]).push(o),n=2;n<t.productions[r[u]].length;n++)s.push(t.productions[r[u]][n]);s.push(o),l.push({production:s,operation:"insert",index:a+h}),h++}return l.push({production:[o],operation:"insert",index:a+h}),l}(t,s[r].base,s[r].recursive)});return n};function Br(){this.root={children:{},values:[]}}Br.prototype.insert=function(t,e){for(var r,n=this.root,s=0;s<t.length;s++)r=t[s],void 0===n.children[r]&&(n.children[r]={children:{},values:[]}),n=n.children[r];n.values.push(e)},Br.prototype.getFactorablePrefixes=function(){var i=[];return function t(e,r){var n,s=(s=[]).concat(r.values);for(n in r.children)s=s.concat(t(e+1,r.children[n]));return 0<e&&2<=s.length&&i.push({length:e,group:s}),s}(0,this.root),i};i=function(t){for(var e,r,n=[],s={},i=0;i<t.productions.length;i++)void 0===s[e=t.productions[i][0]]&&(s[e]=new Br),s[e].insert(t.productions[i].slice(1),i);for(e in s)for(r=s[e].getFactorablePrefixes(),i=0;i<r.length;i++){var o=r[i].length,a=r[i].group;a.sort(),n.push({name:"leftFactor",production:a[0],symbol:0,length:o,changes:function(t,e,r){for(var n=t.calculate("grammar.nonterminals"),s=t.productions[e[0]][0];n.has(s+="'"););for(var i=[],o=0,a=0;a<t.productions.length;a++)-1!==e.indexOf(a)&&(i.push({index:a+o,operation:"delete"}),o--);for(i.push({production:t.productions[e[0]].slice(0,r+1).concat(s),operation:"insert",index:e[0]}),a=0;a<e.length;a++)i.push({production:[s].concat(t.productions[e[a]].slice(r+1)),operation:"insert",index:e[0]+a+1});return i}(t,a,o)})}return n};tr=function(t){var e,r,n,s,i=[];for(e of t.calculate("grammar.nonterminals")){for(n=[],s=-1,r=0;r<t.productions.length;r++)if(t.productions[r][0]===e)if(1===t.productions[r].length){if(-1!==s)break;s=r}else n.push(r);r===t.productions.length&&0<n.length&&-1!==s&&i.push({name:"epsilonSeparate",production:n[0],symbol:0,changes:function(t,e,r){for(var n=t.calculate("grammar.nonterminals"),s=t.productions[e[0]][0];n.has(s+="*"););for(var i=[],o=0,a=0;a<t.productions.length;a++)-1===e.indexOf(a)&&a!==r||(i.push({index:a+o,operation:"delete"}),o--);for(i.push({production:[t.productions[e[0]][0],s],operation:"insert",index:e[0]}),i.push({production:[t.productions[e[0]][0]],operation:"insert",index:e[0]+1}),a=0;a<e.length;a++)i.push({production:[s].concat(t.productions[e[a]].slice(1)),operation:"insert",index:e[0]+a+2});return i}(t,n,s)})}return i};yt=function(t){var e,r,n,s=[];for(e of t.calculate("grammar.unreachable")){for(n=[],r=0;r<t.productions.length;r++)t.productions[r][0]===e&&n.push(r);0<n.length&&s.push({name:"removeUnreachable",production:n[0],symbol:0,changes:function(t,e){for(var r=[],n=0,s=0;s<t.productions.length;s++)-1!==e.indexOf(s)&&(r.push({index:s+n,operation:"delete"}),n--);return r}(t,n)})}return s},kr=function(t){return[].concat(t.calculate("transformations.expand")).concat(t.calculate("transformations.removeImmediateLeftRecursion")).concat(t.calculate("transformations.leftFactor")).concat(t.calculate("transformations.epsilonSeparate")).concat(t.calculate("transformations.removeUnreachable"))};(yr=We).exports["grammar.classification"]=Ve,yr.exports["grammar.nonterminals"]=Qe,yr.exports["grammar.terminals"]=Ue,yr.exports["grammar.symbolInfo"]=He,yr.exports["grammar.start"]=Ge,yr.exports["grammar.productions"]=Xe,yr.exports["grammar.unreachable"]=qe,yr.exports["grammar.unrealizable"]=Ke,yr.exports["grammar.cycle"]=nr,yr.exports["grammar.nullAmbiguity"]=sr,yr.exports["grammar.nullable"]=ir,yr.exports["grammar.first"]=or,yr.exports["grammar.follow"]=ar,yr.exports["grammar.endable"]=fr,yr.exports["grammar.sentences"]=dr,yr.exports["grammar.ambiguous"]=pr,yr.exports["parsing.ll.ll1_classification"]=mr,yr.exports["parsing.ll.ll1_table"]=gr,yr.exports["parsing.lr.lr0_classification"]=vr,yr.exports["parsing.lr.lr0_automaton"]=_r,yr.exports["parsing.lr.lr0_table"]=n,yr.exports["parsing.lr.slr1_classification"]=B,yr.exports["parsing.lr.slr1_table"]=Z,yr.exports["parsing.lr.lr1_automaton"]=Y,yr.exports["parsing.lr.lr1_classification"]=Et,yr.exports["parsing.lr.lr1_table"]=Yt,yr.exports["parsing.lr.lalr1_classification"]=ne,yr.exports["parsing.lr.lalr1_automaton"]=rt,yr.exports["parsing.lr.lalr1_table"]=ot,yr.exports["transformations.expand"]=at,yr.exports["transformations.removeImmediateLeftRecursion"]=q,yr.exports["transformations.leftFactor"]=i,yr.exports["transformations.epsilonSeparate"]=tr,yr.exports["transformations.removeUnreachable"]=yt,yr.exports["transformations.all"]=kr;const jr=We.exports,Vr=lt;yr=class es{constructor(t){var e,r;if(!(t instanceof Array))throw new Error("List of productions must be an array");if(t.length<1)throw new Error("A grammar must have at least one production");for(e=0;e<t.length;e++){if(!(t[e]instanceof Array))throw new Error("Productions must be arrays");if(t[e].length<1)throw new Error("Productions must have at least one symbol");for(r=0;r<t[e].length;r++){if("string"!=typeof t[e][r])throw new Error("Production symbols must be strings");if(t[e][r].match(/^Grammar\./))throw new Error("Reserved symbol "+t[e][r]+" may not be part of a production");if(""===t[e][r])throw new Error("An empty symbol may not be part of a production")}}this.productions=t,this.calculations={}}calculate(t,e={}){return jr[t](this,e)}transform(t){var e=this.productions.slice();return t.changes.forEach(function(t){"delete"===t.operation?e.splice(t.index,1):"insert"===t.operation&&e.splice(t.index,0,t.production)}),new es(e)}getFirst(t){for(var e,r,n=this.calculate("grammar.first"),s=this.calculate("grammar.nullable"),i=this.calculate("grammar.terminals"),o=this.calculate("grammar.nonterminals"),a=new Set,l=0;l<t.length;l++){if((r=t[l])===Vr){a.add(r);break}if(i.has(r)){a.add(r);break}if(!o.has(r))throw new Error("Unexpected symbol "+r);for(e of n.get(r))a.add(e);if(!s.has(r))break}return a}isNullable(t){for(var e,r=this.calculate("grammar.nullable"),n=this.calculate("grammar.terminals"),s=this.calculate("grammar.nonterminals"),i=0;i<t.length;i++){if(e=t[i],!s.has(e)){if(n.has(e))return!1;throw new Error("Unexpected symbol "+e)}if(!r.has(e))return!1}return!0}copyProductions(){for(var t,e=[],r=0;r<this.productions.length;r++)for(e[r]=[],t=0;t<this.productions[r].length;t++)e[r][t]=this.productions[r][t];return e}toString(){for(var t,e="",r=0;r<this.productions.length;r++){for(e+=this.productions[r][0],e+=" ->",t=1;t<this.productions[r].length;t++)e+=" "+this.productions[r][t];e+=" .\n"}return e}},kr={},We={},lt={};Object.defineProperty(lt,"__esModule",{value:!0});let Qr=0;class Ur{constructor(t,e){this.from=t,this.to=e}}class Hr{constructor(t={}){this.id=Qr++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=Yr.match(e)),t=>{t=e(t);return void 0===t?null:[this,t]}}}Hr.closedBy=new Hr({deserialize:t=>t.split(" ")}),Hr.openedBy=new Hr({deserialize:t=>t.split(" ")}),Hr.group=new Hr({deserialize:t=>t.split(" ")}),Hr.contextHash=new Hr({perNode:!0}),Hr.lookAhead=new Hr({perNode:!0}),Hr.mounted=new Hr({perNode:!0});class Gr{constructor(t,e,r){this.tree=t,this.overlay=e,this.parser=r}}const Xr=Object.create(null);class Yr{constructor(t,e,r,n=0){this.name=t,this.props=e,this.id=r,this.flags=n}static define(t){let e=t.props&&t.props.length?Object.create(null):Xr;var r=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(null==t.name?8:0),n=new Yr(t.name||"",e,t.id,r);if(t.props)for(var s of t.props)if(Array.isArray(s)||(s=s(n)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[s[0].id]=s[1]}return n}prop(t){return this.props[t.id]}get isTop(){return 0<(1&this.flags)}get isSkipped(){return 0<(2&this.flags)}get isError(){return 0<(4&this.flags)}get isAnonymous(){return 0<(8&this.flags)}is(e){if("string"!=typeof e)return this.id==e;{if(this.name==e)return!0;let t=this.prop(Hr.group);return!!t&&-1<t.indexOf(e)}}static match(t){let s=Object.create(null);for(var e in t)for(var r of e.split(" "))s[r]=t[e];return r=>{for(let t=r.prop(Hr.group),e=-1;e<(t?t.length:0);e++){var n=s[e<0?r.name:t[e]];if(n)return n}}}}Yr.none=new Yr("",Object.create(null),0,8);const Jr=new WeakMap;class Wr{constructor(t,e,r,n,s){if(this.type=t,this.children=e,this.positions=r,this.length=n,this.props=null,s&&s.length){this.props=Object.create(null);for(var[i,o]of s)this.props["number"==typeof i?i:i.id]=o}}toString(){let t=this.prop(Hr.mounted);if(t&&!t.overlay)return t.tree.toString();let e="";for(var r of this.children){r=r.toString();r&&(e&&(e+=","),e+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t,e=0){var r=null!=t&&Jr.get(this)||this.topNode;let n=new sn(r);return null!=t&&(n.moveTo(t,e),Jr.set(this,n._tree)),n}fullCursor(){return new sn(this.topNode,1)}get topNode(){return new tn(this,0,0,null)}resolve(t,e=0){return this.cursor(t,e).node}resolveInner(t,e=0){let r=this.topNode;for(;;){var n=r.enter(t,e);if(!n)return r;r=n}}iterate(t){let{enter:n,leave:s,from:i=0,to:o=this.length}=t;for(let e=this.cursor(),r=()=>e.node;;){let t=!1;if(e.from<=o&&e.to>=i&&(e.type.isAnonymous||!1!==n(e.type,e.from,e.to,r))){if(e.firstChild())continue;e.type.isAnonymous||(t=!0)}for(;t&&s&&s(e.type,e.from,e.to,r),t=e.type.isAnonymous,!e.nextSibling();){if(!e.parent())return;t=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(var e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:hn(this.type,this.children,this.positions,0,this.children.length,0,this.length,(t,e,r)=>new Wr(this.type,t,e,r,this.propValues),t.makeTree||((t,e,r)=>new Wr(Yr.none,t,e,r)))}static build(t){let{buffer:e,nodeSet:x,maxBufferLength:y=1024,reused:_=[],minRepeatType:k=x.types.length}=t,w=Array.isArray(e)?new Zr(e,e.length):e,S=x.types,C=0,A=0;function P(r,t,e,n,s){for(var a,{id:i,start:o,end:l,size:h}=w,u=A;h<0;){if(w.next(),-1==h){var c=_[i];return e.push(c),void n.push(o-r)}if(-3==h)return void(C=i);if(-4==h)return void(A=i);throw new RangeError(`Unrecognized record size: ${h}`)}let f=S[i],d,p,m=o-r;if(l-o<=y&&(p=function(t,e){let r=w.fork(),n=0,s=0,i=0,o=r.end-y,a={size:0,start:0,skip:0};t:for(var l=r.pos-t;r.pos>l;){var h=r.size;if(r.id==e&&0<=h)a.size=n,a.start=s,a.skip=i,i+=4,n+=4,r.next();else{var u=r.pos-h;if(h<0||u<l||r.start<o)break;let t=r.id>=k?4:0;var c=r.start;for(r.next();r.pos>u;){if(r.size<0){if(-3!=r.size)break t;t+=4}else r.id>=k&&(t+=4);r.next()}s=c,n+=h,i+=t}}(e<0||n==t)&&(a.size=n,a.start=s,a.skip=i);return 4<a.size?a:void 0}(w.pos-t,s))){var g=new Uint16Array(p.size-p.skip);let t=w.pos-p.size,e=g.length;for(;w.pos>t;)e=function e(r,n,s){let{id:i,start:o,end:a,size:l}=w;w.next();if(0<=l&&i<k){let t=s;if(4<l){let t=w.pos-(l-4);for(;w.pos>t;)s=e(r,n,s)}n[--s]=t,n[--s]=a-r,n[--s]=o-r,n[--s]=i}else-3==l?C=i:-4==l&&(A=i);return s}(p.start,g,e);d=new qr(g,l-p.start,x),m=p.start-r}else{var v=w.pos-h;w.next();let t=[],e=[];var b=i>=k?i:-1;let r=0,n=l;for(;w.pos>v;)0<=b&&w.id==b&&0<=w.size?(w.end<=n-y&&(E(t,e,o,r,w.end,n,b,u),r=t.length,n=w.end),w.next()):P(o,v,t,e,b);0<=b&&0<r&&r<t.length&&E(t,e,o,r,o,n,b,u),t.reverse(),e.reverse(),d=-1<b&&0<r?(s=(t,e,r)=>{let n=0,s=t.length-1,i,o;if(0<=s&&(i=t[s])instanceof Wr){if(!s&&i.type==a&&i.length==r)return i;(o=i.prop(Hr.lookAhead))&&(n=e[s]+i.length+o)}return O(a,t,e,r,n)},hn(a=f,t,e,0,t.length,0,l-o,s,s)):O(f,t,e,l-o,u-l)}e.push(d),n.push(m)}function E(t,e,r,n,s,i,o,a){let l=[],h=[];for(;t.length>n;)l.push(t.pop()),h.push(e.pop()+r-s);t.push(O(x.types[o],l,h,i-s,a-i)),e.push(s-r)}function O(t,e,r,n,s=0,i){if(C){let t=[Hr.contextHash,C];i=i?[t].concat(i):[t]}if(25<s){let t=[Hr.lookAhead,s];i=i?[t].concat(i):[t]}return new Wr(t,e,r,n,i)}let r=[],n=[];for(;0<w.pos;)P(t.start||0,t.bufferStart||0,r,n,-1);var s=null!==(s=t.length)&&void 0!==s?s:r.length?n[0]+r[0].length:0;return new Wr(S[t.topID],r.reverse(),n.reverse(),s)}}Wr.empty=new Wr(Yr.none,[],[],0);class Zr{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Zr(this.buffer,this.index)}}class qr{constructor(t,e,r){this.buffer=t,this.length=e,this.set=r}get type(){return Yr.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(t){var e=this.buffer[t],r=this.buffer[t+3];let n=this.set.types[e],s=n.name;if(/\W/.test(s)&&!n.isError&&(s=JSON.stringify(s)),r==(t+=4))return s;let i=[];for(;t<r;)i.push(this.childString(t)),t=this.buffer[t+3];return s+"("+i.join(",")+")"}findChild(e,r,n,s,i){let o=this["buffer"],a=-1;for(let t=e;t!=r&&!(Kr(i,s,o[t+1],o[t+2])&&(a=t,0<n));t=o[t+3]);return a}slice(r,n,s,t){var i=this.buffer;let o=new Uint16Array(n-r);for(let t=r,e=0;t<n;)o[e++]=i[t++],o[e++]=i[t++]-s,o[e++]=i[t++]-s,o[e++]=i[t++]-r;return new qr(o,t-s,this.set)}}function Kr(t,e,r,n){switch(t){case-2:return r<e;case-1:return e<=n&&r<e;case 0:return r<e&&e<n;case 1:return r<=e&&e<n;case 2:return e<n;case 4:return 1}}class tn{constructor(t,e,r,n){this.node=t,this._from=e,this.index=r,this._parent=n}get type(){return this.node.type}get name(){return this.node.type.name}get from(){return this._from}get to(){return this._from+this.node.length}nextChild(i,o,a,l,h=0){for(let s=this;;){for(var{children:t,positions:e}=s.node,r=0<o?t.length:-1;i!=r;i+=o){let r=t[i],n=e[i]+s._from;if(Kr(l,a,n,n+r.length))if(r instanceof qr){if(!(2&h)){var u=r.findChild(0,r.buffer.length,o,a-n,l);if(-1<u)return new nn(new rn(s,r,i,n),null,u)}}else if(1&h||!r.type.isAnonymous||on(r)){let t;if(r.props&&(t=r.prop(Hr.mounted))&&!t.overlay)return new tn(t.tree,n,i,s);let e=new tn(r,n,i,s);return 1&h||!e.type.isAnonymous?e:e.nextChild(o<0?r.children.length-1:0,o,a,l)}}if(1&h||!s.type.isAnonymous)return null;if(i=0<=s.index?s.index+o:o<0?-1:s._parent.node.children.length,s=s._parent,!s)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this.node.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this.node.children.length-1,-1,t,-2)}enter(t,e,r=!0,n=!0){let s;if(r&&(s=this.node.prop(Hr.mounted))&&s.overlay){var i,o,a=t-this.from;for({from:i,to:o}of s.overlay)if((0<e?i<=a:i<a)&&(e<0?o>=a:o>a))return new tn(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,n?0:2)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&0<=this.index?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&0<=this.index?this._parent.nextChild(this.index-1,-1,0,4):null}get cursor(){return new sn(this)}get tree(){return this.node}toTree(){return this.node}resolve(t,e=0){return this.cursor.moveTo(t,e).node}getChild(t,e=null,r=null){r=en(this,t,e,r);return r.length?r[0]:null}getChildren(t,e=null,r=null){return en(this,t,e,r)}toString(){return this.node.toString()}}function en(t,e,r,n){let s=t.cursor,i=[];if(!s.firstChild())return i;if(null!=r)for(;!s.type.is(r);)if(!s.nextSibling())return i;for(;;){if(null!=n&&s.type.is(n))return i;if(s.type.is(e)&&i.push(s.node),!s.nextSibling())return null==n?i:[]}}class rn{constructor(t,e,r,n){this.parent=t,this.buffer=e,this.index=r,this.start=n}}class nn{constructor(t,e,r){this.context=t,this._parent=e,this.index=r,this.type=t.buffer.set.types[t.buffer.buffer[r]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(t,e,r){let n=this.context["buffer"];r=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.context.start,r);return r<0?null:new nn(this.context,this,r)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,r,n=!0){if(!n)return null;let s=this.context["buffer"];e=s.findChild(this.index+4,s.buffer[this.index+3],0<e?1:-1,t-this.context.start,e);return e<0?null:new nn(this.context,this,e)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){var t=this.context["buffer"],e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new nn(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let t=this.context["buffer"];var e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new nn(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}get cursor(){return new sn(this)}get tree(){return null}toTree(){let t=[],e=[],r=this.context["buffer"];var n,s,i=this.index+4,o=r.buffer[this.index+3];return i<o&&(n=r.buffer[this.index+1],s=r.buffer[this.index+2],t.push(r.slice(i,o,n,s)),e.push(0)),new Wr(this.type,t,e,this.to-this.from)}resolve(t,e=0){return this.cursor.moveTo(t,e).node}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,r=null){r=en(this,t,e,r);return r.length?r[0]:null}getChildren(t,e=null,r=null){return en(this,t,e,r)}}class sn{constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof tn)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(t){return!!t&&(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0)}yieldBuf(t,e){this.index=t;var{start:r,buffer:n}=this.buffer;return this.type=e||n.set.types[n.buffer[t]],this.from=r+n.buffer[t+1],this.to=r+n.buffer[t+2],!0}yield(t){return!!t&&(t instanceof tn?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,r){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree.node.children.length-1:0,t,e,r,this.mode));let n=this.buffer["buffer"];r=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.buffer.start,r);return!(r<0)&&(this.stack.push(this.index),this.yieldBuf(r))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,r=!0,n=!0){return this.buffer?!!n&&this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,r,n))}parent(){if(!this.buffer)return this.yieldNode(1&this.mode?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());var t=1&this.mode?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode));let e=this.buffer["buffer"],r=this.stack.length-1;if(t<0){var n=r<0?0:this.stack[r]+4;if(this.index!=n)return this.yieldBuf(e.findChild(n,this.index,-1,0,4))}else{n=e.buffer[this.index+3];if(n<(r<0?e.buffer.length:e.buffer[this.stack[r]+3]))return this.yieldBuf(n)}return r<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(r){let n,s,e=this["buffer"];if(e){if(0<r){if(this.index<e.buffer.buffer.length)return!1}else for(let t=0;t<this.index;t++)if(e.buffer.buffer[t+3]<this.index)return!1;({index:n,parent:s}=e)}else({index:n,_parent:s}=this._tree);for(;s;{index:n,_parent:s}=s)if(-1<n)for(let t=n+r,e=r<0?-1:s.node.children.length;t!=e;t+=r){var i=s.node.children[t];if(1&this.mode||i instanceof qr||!i.type.isAnonymous||on(i))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(-1<e?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let n=this.bufferNode,s=null,i=0;if(n&&n.context==this.buffer)t:for(let e=this.index,r=this.stack.length;0<=r;){for(let t=n;t;t=t._parent)if(t.index==e){if(e==this.index)return t;s=t,i=r+1;break t}e=this.stack[--r]}for(let t=i;t<this.stack.length;t++)s=new nn(this.buffer,s,this.stack[t]);return this.bufferNode=new nn(this.buffer,s,this.index)}get tree(){return this.buffer?null:this._tree.node}}function on(t){return t.children.some(t=>t instanceof qr||!t.type.isAnonymous||on(t))}const an=new WeakMap;function ln(r,t){if(!r.isAnonymous||t instanceof qr||t.type!=r)return 1;let e=an.get(t);return null==e&&(e=t.children.reduce((t,e)=>t+ln(r,e),1),an.set(t,e)),e}function hn(c,e,t,r,n,f,s,i,d){let o=0;for(let t=r;t<n;t++)o+=ln(c,e[t]);let p=Math.ceil(1.5*o/8),m=[],g=[];return function s(i,o,t,a,l){for(let n=t;n<a;){let t=n,e=o[n],r=ln(c,i[n]);for(n++;n<a;n++){var h=ln(c,i[n]);if(r+h>=p)break;r+=h}if(n==t+1){if(r>p){var u=i[t];s(u.children,u.positions,0,u.children.length,o[t]+l);continue}m.push(i[t])}else u=o[n-1]+i[n-1].length-e,m.push(hn(c,i,o,t,n,e,u,null,d));g.push(e+l-f)}}(e,t,r,n,0),(i||d)(m,g,s)}class un{constructor(t,e,r,n,s=!1,i=!1){this.from=t,this.to=e,this.tree=r,this.offset=n,this.open=(s?1:0)|(i?2:0)}get openStart(){return 0<(1&this.open)}get openEnd(){return 0<(2&this.open)}static addTree(t,e=[],r=!1){let n=[new un(0,t.length,t,0,!1,r)];for(var s of e)s.to>t.length&&n.push(s);return n}static applyChanges(s,t,i=128){if(!t.length)return s;let o=[],a=1,l=s.length?s[0]:null;for(let e=0,r=0,n=0;;e++){var h,u,c=e<t.length?t[e]:null,f=c?c.fromA:1e9;if(f-r>=i)for(;l&&l.from<f;){let t=l;if((r>=t.from||f<=t.to||n)&&(h=Math.max(t.from,r)-n,u=Math.min(t.to,f)-n,t=u<=h?null:new un(h,u,t.tree,t.offset+n,0<e,!!c)),t&&o.push(t),l.to>f)break;l=a<s.length?s[a++]:null}if(!c)break;r=c.toA,n=c.toA-c.toB}return o}}class cn{constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,e){return this.string.slice(t,e)}}class fn{constructor(t,e,r,n){this.parser=t,this.parse=e,this.overlay=r,this.target=n}}class dn{constructor(t,e,r,n,s,i,o){this.parser=t,this.predicate=e,this.mounts=r,this.index=n,this.start=s,this.target=i,this.prev=o,this.depth=0,this.ranges=[]}}class pn{constructor(t,e,r,n,s){this.nest=e,this.input=r,this.fragments=n,this.ranges=s,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=t}advance(){if(this.baseParse){var t=this.baseParse.advance();if(!t)return null;this.baseParse=null,this.baseTree=t,this.startInner()}if(this.innerDone==this.inner.length)return this.baseTree;let e=this.inner[this.innerDone],r=e.parse.advance();if(r){this.innerDone++;let t=Object.assign(Object.create(null),e.target.props);t[Hr.mounted.id]=new Gr(r,e.overlay,e.parser),e.target.props=t}return null}get parsedPos(){if(this.baseParse)return 0;var t=this.inner[this.innerDone];return t?t.parse.parsedPos:this.input.length}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].parse.stopAt(e)}startInner(){let i=new vn(this.fragments);t:for(let r=this.baseTree.fullCursor(),n,s=null;;){let t=!0,e;if(i.hasNode(r)){if(s){var o=s.mounts.find(t=>t.frag.from<=r.from&&t.frag.to>=r.to&&t.mount.overlay);if(o)for(var a of o.mount.overlay){var l=a.from+o.pos,a=a.to+o.pos;l>=r.from&&a<=r.to&&s.ranges.push({from:l,to:a})}}t=!1}else{var h,u;!r.type.isAnonymous&&r.from<r.to&&(n=this.nest(r,this.input))?(r.tree||function(e){let l=e["node"],r=0;for(;e.parent(),r++,!e.tree;);let t=0,n=e.tree,h=0;for(;h=n.positions[t]+e.from,!(h<=l.from&&h+n.children[t].length>=l.to);t++);let u=n.children[t],c=u.buffer;n.children[t]=function t(e,r,n,s){let i=e;for(;c[i+2]+h<=l.from;)i=c[i+3];let o=[],a=[];mn(u,e,i,o,a,s);e=c[i+1]+h==l.from&&c[i+2]+h==l.to&&c[i]==l.type.id;o.push(e?l.toTree():t(i+4,c[i+3],u.set.types[c[i]],c[i+1])),a.push(c[i+1]-s),mn(u,c[i+3],r,o,a,s);s=o.length-1;return new Wr(n,o,a,a[s]+o[s].length)}(0,c.length,Yr.none,0);for(let t=0;t<=r;t++)e.childAfter(l.from)}(r),h=i.findMounts(r.from,n.parser),"function"==typeof n.overlay?s=new dn(n.parser,n.overlay,h,this.inner.length,r.from,r.tree,s):((u=bn(this.ranges,n.overlay||[new Ur(r.from,r.to)])).length&&this.inner.push(new fn(n.parser,n.parser.startParse(this.input,xn(h,u),u),n.overlay?n.overlay.map(t=>new Ur(t.from-r.from,t.to-r.from)):null,r.tree)),t=!1)):s&&(e=s.predicate(r))&&(!0===e&&(e=new Ur(r.from,r.to)),e.from<e.to&&s.ranges.push(e))}if(t&&r.firstChild())s&&s.depth++;else for(;!r.nextSibling();){if(!r.parent())break t;var c;s&&!--s.depth&&((c=bn(this.ranges,s.ranges)).length&&this.inner.splice(s.index,0,new fn(s.parser,s.parser.startParse(this.input,xn(s.mounts,c),c),s.ranges.map(t=>new Ur(t.from-s.start,t.to-s.start)),s.target)),s=s.prev)}}}}function mn(t,e,r,n,s,i){var o,a;e<r&&(o=t.buffer[e+1],a=t.buffer[r-2],n.push(t.slice(e,r,o,a)),s.push(o-i))}class gn{constructor(t,e){this.offset=e,this.done=!1,this.cursor=t.fullCursor()}moveTo(t){let e=this["cursor"],r=t-this.offset;for(;!this.done&&e.from<r;)e.to>=t&&e.enter(r,1,!1,!1)||e.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from)for(let t=this.cursor.tree;;){if(t==e.tree)return!0;if(!(t.children.length&&0==t.positions[0]&&t.children[0]instanceof Wr))break;t=t.children[0]}return!1}}class vn{constructor(t){this.fragments=t,this.fragI=0,t.length?(t=this.curFrag=t[0],this.inner=new gn(t.tree,-t.offset)):this.curFrag=this.inner=null}hasNode(t){for(;this.curFrag&&t.from>=this.curFrag.to;)this.nextFrag();return this.curFrag&&this.curFrag.from<=t.from&&this.curFrag.to>=t.to&&this.inner.hasNode(t)}nextFrag(){var t;this.fragI++,this.fragI==this.fragments.length?this.curFrag=this.inner=null:(t=this.curFrag=this.fragments[this.fragI],this.inner=new gn(t.tree,-t.offset))}findMounts(t,r){var n;let s=[];if(this.inner){this.inner.cursor.moveTo(t,1);for(let e=this.inner.cursor.node;e;e=e.parent){var i=null===(n=e.tree)||void 0===n?void 0:n.prop(Hr.mounted);if(i&&i.parser==r)for(let t=this.fragI;t<this.fragments.length;t++){var o=this.fragments[t];if(o.from>=e.to)break;o.tree==this.curFrag.tree&&s.push({frag:o,pos:e.from-o.offset,mount:i})}}}return s}}function bn(r,n){let s=null,i=n;for(let t=1,e=0;t<r.length;t++)for(var o=r[t-1].to,a=r[t].from;e<i.length;e++){var l=i[e];if(l.from>=a)break;l.to<=o||(s||(i=s=n.slice()),l.from<o?(s[e]=new Ur(l.from,o),l.to>a&&s.splice(e+1,0,new Ur(a,l.to))):l.to>a?s[e--]=new Ur(a,l.to):s.splice(e--,1))}return i}function xn(t,s){let i=[];for(let{pos:e,mount:r,frag:n}of t){var o=e+(r.overlay?r.overlay[0].from:0),a=o+r.tree.length,l=Math.max(n.from,o),h=Math.min(n.to,a);if(r.overlay){var u=function(t,e,r,n){let s=0,i=0,o=!1,a=!1,l=-1e9,h=[];for(;;){var u,c,f=s==t.length?1e9:o?t[s].to:t[s].from,d=i==e.length?1e9:a?e[i].to:e[i].from;if(o==a||(u=Math.max(l,r))<(c=Math.min(f,d,n))&&h.push(new Ur(u,c)),l=Math.min(f,d),1e9==l)break;f==l&&(o?(o=!1,s++):o=!0),d==l&&(a?(a=!1,i++):a=!0)}return h}(s,r.overlay.map(t=>new Ur(t.from+e,t.to+e)),l,h);for(let t=0,e=l;;t++){var c=t==u.length,f=c?h:u[t].from;if(f>e&&i.push(new un(e,f,r.tree,-o,n.from>=e,n.to<=f)),c)break;e=u[t].to}}else i.push(new un(l,h,r.tree,-o,n.from>=o,n.to<=a))}return i}lt.DefaultBufferLength=1024,lt.MountedTree=Gr,lt.NodeProp=Hr,lt.NodeSet=class ss{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let r=[];for(var n of this.types){let t=null;for(var s of e)(s=s(n))&&(t=t||Object.assign({},n.props),t[s[0].id]=s[1]);r.push(t?new Yr(n.name,t,n.id,n.flags):n)}return new ss(r)}},lt.NodeType=Yr,lt.Parser=class{startParse(t,e,r){return"string"==typeof t&&(t=new cn(t)),r=r?r.length?r.map(t=>new Ur(t.from,t.to)):[new Ur(0,0)]:[new Ur(0,t.length)],this.createParse(t,e||[],r)}parse(t,e,r){let n=this.startParse(t,e,r);for(;;){var s=n.advance();if(s)return s}}},lt.Tree=Wr,lt.TreeBuffer=qr,lt.TreeCursor=sn,lt.TreeFragment=un,lt.parseMixed=function(s){return(t,e,r,n)=>new pn(t,s,e,r,n)},Object.defineProperty(We,"__esModule",{value:!0});var yn,_n,kn=lt;class wn{constructor(t,e,r,n,s,i,o,a,l,h=0,u){this.p=t,this.stack=e,this.state=r,this.reducePos=n,this.pos=s,this.score=i,this.buffer=o,this.bufferBase=a,this.curContext=l,this.lookAhead=h,this.parent=u}toString(){return`[${this.stack.filter((t,e)=>e%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(t,e,r=0){var n=t.parser.context;return new wn(t,[],e,r,r,0,[],0,n?new Sn(n,n.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(t,e){this.stack.push(this.state,e,this.bufferBase+this.buffer.length),this.state=t}reduce(t){var e=t>>19,r=65535&t;let n=this.p["parser"];var s=n.dynamicPrecedence(r);if(s&&(this.score+=s),0==e)return r<n.minRepeatTerm&&this.storeNode(r,this.reducePos,this.reducePos,4,!0),this.pushState(n.getGoto(this.state,r,!0),this.reducePos),void this.reduceContext(r,this.reducePos);var i=this.stack.length-3*(e-1)-(262144&t?6:0),o=this.stack[i-2],s=this.stack[i-1],e=this.bufferBase+this.buffer.length-s;for((r<n.minRepeatTerm||131072&t)&&(s=n.stateFlag(this.state,1)?this.pos:this.reducePos,this.storeNode(r,o,s,4+e,!0)),262144&t?this.state=this.stack[i]:(t=this.stack[i-3],this.state=n.getGoto(t,r,!0));this.stack.length>i;)this.stack.pop();this.reduceContext(r,o)}storeNode(e,r,n,s=4,t=!1){if(0==e){let t=this,e=this.buffer.length;if(0==e&&t.parent&&(e=t.bufferBase-t.parent.bufferBase,t=t.parent),0<e&&0==t.buffer[e-4]&&-1<t.buffer[e-1]){if(r==n)return;if(t.buffer[e-2]>=r)return void(t.buffer[e-2]=n)}}if(t&&this.pos!=n){let t=this.buffer.length;if(0<t&&0!=this.buffer[t-4])for(;0<t&&this.buffer[t-2]>n;)this.buffer[t]=this.buffer[t-4],this.buffer[t+1]=this.buffer[t-3],this.buffer[t+2]=this.buffer[t-2],this.buffer[t+3]=this.buffer[t-1],t-=4,4<s&&(s-=4);this.buffer[t]=e,this.buffer[t+1]=r,this.buffer[t+2]=n,this.buffer[t+3]=s}else this.buffer.push(e,r,n,s)}shift(r,n,s){var i=this.pos;if(131072&r)this.pushState(65535&r,this.pos);else if(0==(262144&r)){let t=r,e=this.p["parser"];(s>this.pos||n<=e.maxNode)&&(this.pos=s,e.stateFlag(t,1)||(this.reducePos=s)),this.pushState(t,i),this.shiftContext(n,i),n<=e.maxNode&&this.buffer.push(n,i,s,4)}else this.pos=s,this.shiftContext(n,i),n<=this.p.parser.maxNode&&this.buffer.push(n,i,s,4)}apply(t,e,r){65536&t?this.reduce(t):this.shift(t,e,r)}useNode(t,e){let r=this.p.reused.length-1;(r<0||this.p.reused[r]!=t)&&(this.p.reused.push(t),r++);var n=this.pos;this.reducePos=this.pos=n+t.length,this.pushState(e,n),this.buffer.push(r,n,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,t,this,this.p.stream.reset(this.pos-t.length)))}split(){let t=this,e=t.buffer.length;for(;0<e&&t.buffer[e-2]>t.reducePos;)e-=4;for(var r=t.buffer.slice(e),n=t.bufferBase+e;t&&n==t.bufferBase;)t=t.parent;return new wn(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,r,n,this.curContext,this.lookAhead,t)}recoverByDelete(t,e){var r=t<=this.p.parser.maxNode;r&&this.storeNode(t,this.pos,e,4),this.storeNode(0,this.pos,e,r?8:4),this.pos=this.reducePos=e,this.score-=190}canShift(e){for(let t=new Cn(this);;){var r=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(0==(65536&r))return!0;if(0==r)return!1;t.reduce(r)}}recoverByInsert(r){if(300<=this.stack.length)return[];let s=this.p.parser.nextStates(this.state);if(8<s.length||120<=this.stack.length){let n=[];for(let t=0,e;t<s.length;t+=2)(e=s[t+1])!=this.state&&this.p.parser.hasAction(e,r)&&n.push(s[t],e);if(this.stack.length<120)for(let t=0;n.length<8&&t<s.length;t+=2){let r=s[t+1];n.some((t,e)=>1&e&&t==r)||n.push(s[t],r)}s=n}let n=[];for(let e=0;e<s.length&&n.length<4;e+=2){var i=s[e+1];if(i!=this.state){let t=this.split();t.storeNode(0,t.pos,t.pos,4,!0),t.pushState(i,this.pos),t.shiftContext(s[e],this.pos),t.score-=200,n.push(t)}}return n}forceReduce(){var t=this.p.parser.stateSlot(this.state,5);return 0!=(65536&t)&&(this.p.parser.validAction(this.state,t)||(this.storeNode(0,this.reducePos,this.reducePos,4,!0),this.score-=100),this.reduce(t),!0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2)&&this.forceReduce(););return this}get deadEnd(){if(3!=this.stack.length)return!1;let t=this.p["parser"];return 65535==t.data[t.stateSlot(this.state,1)]&&!t.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(t){return this.p.parser.dialect.flags[t]}shiftContext(t,e){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,t,this,this.p.stream.reset(e)))}reduceContext(t,e){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,t,this,this.p.stream.reset(e)))}emitContext(){var t=this.buffer.length-1;(t<0||-3!=this.buffer[t])&&this.buffer.push(this.curContext.hash,this.reducePos,this.reducePos,-3)}emitLookAhead(){var t=this.buffer.length-1;(t<0||-4!=this.buffer[t])&&this.buffer.push(this.lookAhead,this.reducePos,this.reducePos,-4)}updateContext(t){t!=this.curContext.context&&((t=new Sn(this.curContext.tracker,t)).hash!=this.curContext.hash&&this.emitContext(),this.curContext=t)}setLookAhead(t){t>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=t)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),0<this.lookAhead&&this.emitLookAhead()}}class Sn{constructor(t,e){this.tracker=t,this.context=e,this.hash=t.strict?t.hash(e):0}}(yn=yn=yn||{})[yn.Insert=200]="Insert",yn[yn.Delete=190]="Delete",yn[yn.Reduce=100]="Reduce",yn[yn.MaxNext=4]="MaxNext",yn[yn.MaxInsertStackDepth=300]="MaxInsertStackDepth",yn[yn.DampenInsertStackDepth=120]="DampenInsertStackDepth";class Cn{constructor(t){this.start=t,this.state=t.state,this.stack=t.stack,this.base=this.stack.length}reduce(t){var e=65535&t,t=t>>19;0==t?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=3*(t-1);e=this.start.p.parser.getGoto(this.stack[this.base-3],e,!0);this.state=e}}class An{constructor(t,e,r){this.stack=t,this.pos=e,this.index=r,this.buffer=t.buffer,0==this.index&&this.maybeNext()}static create(t,e=t.bufferBase+t.buffer.length){return new An(t,e,e-t.bufferBase)}maybeNext(){var t=this.stack.parent;null!=t&&(this.index=this.stack.bufferBase-t.bufferBase,this.stack=t,this.buffer=t.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,0==this.index&&this.maybeNext()}fork(){return new An(this.stack,this.pos,this.index)}}class Pn{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const En=new Pn;class On{constructor(t,e){this.input=t,this.ranges=e,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=En,this.rangeIndex=0,this.pos=this.chunkPos=e[0].from,this.range=e[0],this.end=e[e.length-1].to,this.readNext()}resolveOffset(t,e){let r=this.range,n=this.rangeIndex,s=this.pos+t;for(;s<r.from;){if(!n)return null;var i=this.ranges[--n];s-=r.from-i.to,r=i}for(;e<0?s>r.to:s>=r.to;){if(n==this.ranges.length-1)return null;var o=this.ranges[++n];s+=o.from-r.to,r=o}return s}peek(t){let e=this.chunkOff+t,r,n;if(0<=e&&e<this.chunk.length)r=this.pos+t,n=this.chunk.charCodeAt(e);else{t=this.resolveOffset(t,1);if(null==t)return-1;if(r=t,r>=this.chunk2Pos&&r<this.chunk2Pos+this.chunk2.length)n=this.chunk2.charCodeAt(r-this.chunk2Pos);else{let t=this.rangeIndex,e=this.range;for(;e.to<=r;)e=this.ranges[++t];this.chunk2=this.input.chunk(this.chunk2Pos=r),r+this.chunk2.length>e.to&&(this.chunk2=this.chunk2.slice(0,e.to-r)),n=this.chunk2.charCodeAt(0)}}return r>this.token.lookAhead&&(this.token.lookAhead=r),n}acceptToken(t,e=0){e=e?this.resolveOffset(e,-1):this.pos;if(null==e||e<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=t,this.token.end=e}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){var{chunk:t,chunkPos:e}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=t,this.chunk2Pos=e,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let t=this.input.chunk(this.pos);e=this.pos+t.length;this.chunk=e>this.range.to?t.slice(0,this.range.to-this.pos):t,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(t=1){for(this.chunkOff+=t;this.pos+t>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();t-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=t,this.pos>this.token.lookAhead&&(this.token.lookAhead=this.pos),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(t,e){if(e?((this.token=e).start=e.lookAhead=t,e.value=e.extended=-1):this.token=En,this.pos!=t){if((this.pos=t)==this.end)return this.setDone(),this;for(;t<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;t>=this.range.to;)this.range=this.ranges[++this.rangeIndex];t>=this.chunkPos&&t<this.chunkPos+this.chunk.length?this.chunkOff=t-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(t,e){if(t>=this.chunkPos&&e<=this.chunkPos+this.chunk.length)return this.chunk.slice(t-this.chunkPos,e-this.chunkPos);if(t>=this.range.from&&e<=this.range.to)return this.input.read(t,e);let r="";for(var n of this.ranges){if(n.from>=e)break;n.to>t&&(r+=this.input.read(Math.max(n.from,t),Math.min(n.to,e)))}return r}}class Tn{constructor(t,e){this.data=t,this.id=e}token(t,e){!function(n,s,t,e){let i=0,r=1<<e,o=t.p["parser"],a=o["dialect"];t:for(;0!=(r&n[i]);){var l=n[i+1];for(let t=i+3;t<l;t+=2)if(0<(n[t+1]&r)){var h=n[t];if(a.allows(h)&&(-1==s.token.value||s.token.value==h||o.overrides(h,s.token.value))){s.acceptToken(h);break}}for(let t=s.next,e=0,r=n[i+2];e<r;){var u=e+r>>1,c=l+u+(u<<1),f=n[c],d=n[c+1];if(t<f)r=u;else{if(!(d<=t)){i=n[c+2],s.advance();continue t}e=1+u}}break}}(this.data,t,e,this.id)}}Tn.prototype.contextual=Tn.prototype.fallback=Tn.prototype.extend=!1;function Nn(i,e=Uint16Array){if("string"!=typeof i)return i;let r=null;for(let s=0,t=0;s<i.length;){let n=0;for(;;){let t=i.charCodeAt(s++),e=!1;if(126==t){n=65535;break}92<=t&&t--,34<=t&&t--;let r=t-32;if(46<=r&&(r-=46,e=!0),n+=r,e)break;n*=46}r?r[t++]=n:r=new e(n)}return r}const zn="undefined"!=typeof process&&/\bparse\b/.test(process.env.LOG);let Ln=null;function Rn(t,e,r){let n=t.fullCursor();for(n.moveTo(e);;)if(!(r<0?n.childBefore(e):n.childAfter(e)))for(;;){if((r<0?n.to<e:n.from>e)&&!n.type.isError)return r<0?Math.max(0,Math.min(n.to-1,e-25)):Math.min(t.length,Math.max(n.from+1,e+25));if(r<0?n.prevSibling():n.nextSibling())break;if(!n.parent())return r<0?0:t.length}}_n=_n||{},_n[_n.Margin=25]="Margin";class Dn{constructor(t,e){this.fragments=t,this.nodeSet=e,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){var t=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(t){for(this.safeFrom=t.openStart?Rn(t.tree,t.from+t.offset,1)-t.offset:t.from,this.safeTo=t.openEnd?Rn(t.tree,t.to+t.offset,-1)-t.offset:t.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(t.tree),this.start.push(-t.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){var r=this.trees.length-1;if(r<0)return this.nextFragment(),null;var n=this.trees[r],s=this.index[r];if(s!=n.children.length){let t=n.children[s];var i=this.start[r]+n.positions[s];if(e<i)return this.nextStart=i,null;if(t instanceof kn.Tree){if(i==e){if(i<this.safeFrom)return null;n=i+t.length;if(n<=this.safeTo){s=t.prop(kn.NodeProp.lookAhead);if(!s||n+s<this.fragment.to)return t}}this.index[r]++,i+t.length>=Math.max(this.safeFrom,e)&&(this.trees.push(t),this.start.push(i),this.index.push(0))}else this.index[r]++,this.nextStart=i+t.length}else this.trees.pop(),this.start.pop(),this.index.pop()}}}const In=new Pn;class $n{constructor(t,e){this.stream=e,this.tokens=[],this.mainToken=In,this.actions=[],this.tokens=t.tokenizers.map(t=>new Pn)}getActions(n){let s=0,i=null,t=n.p["parser"],o=t["tokenizers"];var a=t.stateSlot(n.state,3),l=n.curContext?n.curContext.hash:0;let h=0;for(let r=0;r<o.length;r++)if(0!=(1<<r&a)){let t=o[r],e=this.tokens[r];if((!i||t.fallback)&&(!t.contextual&&e.start==n.pos&&e.mask==a&&e.context==l||(this.updateCachedToken(e,t,n),e.mask=a,e.context=l),e.lookAhead>e.end+25&&(h=Math.max(e.lookAhead,h)),0!=e.value)){var u=s;if(-1<e.extended&&(s=this.addActions(n,e.extended,e.end,s)),s=this.addActions(n,e.value,e.end,s),!t.extend&&(i=e,s>u))break}}for(;this.actions.length>s;)this.actions.pop();return h&&n.setLookAhead(h),i||(i=In,i.start=n.pos,n.pos==this.stream.end?(i.value=n.p.parser.eofTerm,i.end=n.pos,s=this.addActions(n,i.value,i.end,s)):(i.value=0,i.end=n.pos+1)),this.mainToken=i,this.actions}updateCachedToken(r,t,n){if(t.token(this.stream.reset(n.pos,r),n),-1<r.value){let e=n.p["parser"];for(let t=0;t<e.specialized.length;t++)if(e.specialized[t]==r.value){var s=e.specializers[t](this.stream.read(r.start,r.end),n);if(0<=s&&n.p.parser.dialect.allows(s>>1)){0==(1&s)?r.value=s>>1:r.extended=s>>1;break}}}else r.value=0,r.end=n.pos+1}putAction(e,t,r,n){for(let t=0;t<n;t+=3)if(this.actions[t]==e)return n;return this.actions[n++]=e,this.actions[n++]=t,this.actions[n++]=r,n}addActions(t,r,n,s){let i=t["state"],o=t.p["parser"],a=o["data"];for(let e=0;e<2;e++)for(let t=o.stateSlot(i,e?2:1);;t+=3){if(65535==a[t]){if(1!=a[t+1]){0==s&&2==a[t+1]&&(s=this.putAction(Qn(a,t+1),r,n,s));break}t=Qn(a,t+2)}a[t]==r&&(s=this.putAction(Qn(a,t+1),r,n,s))}return s}}(Hn=Hn=Hn||{})[Hn.Distance=5]="Distance",Hn[Hn.MaxRemainingPerStep=3]="MaxRemainingPerStep",Hn[Hn.MinBufferLengthPrune=200]="MinBufferLengthPrune",Hn[Hn.ForceReduceLimit=10]="ForceReduceLimit";class Fn{constructor(t,e,r,n){this.parser=t,this.input=e,this.ranges=n,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.stream=new On(e,n),this.tokens=new $n(t,this.stream),this.topTerm=t.top[1];var n=n[0]["from"];this.stacks=[wn.start(this,t.top[0],n)],this.fragments=r.length&&this.stream.end-n>4*t.bufferLength?new Dn(r,t.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,r=this.minStackPos,n=this.stacks=[],s,i;for(let t=0;t<e.length;t++)for(var o=e[t];;){if(o.pos>r)n.push(o);else{if(this.advanceStack(o,n,e))continue;s||(s=[],i=[]),s.push(o);var a=this.tokens.mainToken;i.push(a.value,a.end)}break}if(!n.length){var t=s&&function(t){let e=null;for(var r of t){var n=r.p.stoppedAt;(r.pos==r.p.stream.end||null!=n&&r.pos>n)&&r.p.parser.stateFlag(r.state,2)&&(!e||e.score<r.score)&&(e=r)}return e}(s);if(t)return this.stackToTree(t);if(this.parser.strict)throw zn&&s&&console.log("Stuck with token "+this.parser.getName(this.tokens.mainToken.value)),new SyntaxError("No parse at "+r);this.recovering||(this.recovering=5)}if(this.recovering&&s){let t=this.runRecovery(s,i,n);if(t)return this.stackToTree(t.forceAll())}if(this.recovering){var l=1==this.recovering?1:3*this.recovering;if(n.length>l)for(n.sort((t,e)=>e.score-t.score);n.length>l;)n.pop();n.some(t=>t.reducePos>r)&&this.recovering--}else if(1<n.length)t:for(let r=0;r<n.length-1;r++){let e=n[r];for(let t=r+1;t<n.length;t++){var h=n[t];if(e.sameState(h)||200<e.buffer.length&&200<h.buffer.length){if(!(0<(e.score-h.score||e.buffer.length-h.buffer.length))){n.splice(r--,1);continue t}n.splice(t--,1)}}}this.minStackPos=n[0].pos;for(let t=1;t<n.length;t++)n[t].pos<this.minStackPos&&(this.minStackPos=n[t].pos);return null}stopAt(t){if(null!=this.stoppedAt&&this.stoppedAt<t)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=t}advanceStack(r,n,s){let i=r.pos,o=this["parser"];var a=zn?this.stackID(r)+" -> ":"";if(null!=this.stoppedAt&&i>this.stoppedAt)return r.forceReduce()?r:null;if(this.fragments){var e=r.curContext&&r.curContext.tracker.strict,l=e?r.curContext.hash:0;for(let t=this.fragments.nodeAt(i);t;){var h=this.parser.nodeSet.types[t.type.id]==t.type?o.getGoto(r.state,t.type.id):-1;if(-1<h&&t.length&&(!e||(t.prop(kn.NodeProp.contextHash)||0)==l))return r.useNode(t,h),zn&&console.log(a+this.stackID(r)+` (via reuse of ${o.getName(t.type.id)})`),!0;if(!(t instanceof kn.Tree)||0==t.children.length||0<t.positions[0])break;h=t.children[0];if(!(h instanceof kn.Tree&&0==t.positions[0]))break;t=h}}var t=o.stateSlot(r.state,4);if(0<t)return r.reduce(t),zn&&console.log(a+this.stackID(r)+` (via always-reduce ${o.getName(65535&t)})`),!0;var u=this.tokens.getActions(r);for(let e=0;e<u.length;){var c=u[e++],f=u[e++],d=u[e++],p=e==u.length||!s;let t=p?r:r.split();if(t.apply(c,f,d),zn&&console.log(a+this.stackID(t)+` (via ${0==(65536&c)?"shift":`reduce of ${o.getName(65535&c)}`} for ${o.getName(f)} @ ${i}${t==r?"":", split"})`),p)return!0;(t.pos>i?n:s).push(t)}return!1}advanceFully(t,e){for(var r=t.pos;;){if(!this.advanceStack(t,null,null))return!1;if(t.pos>r)return Mn(t,e),!0}}runRecovery(o,a,l){let h=null,u=!1;for(let i=0;i<o.length;i++){let t=o[i],e=a[i<<1],r=a[1+(i<<1)];var c,f=zn?this.stackID(t)+" -> ":"";if(t.deadEnd){if(u)continue;if(u=!0,t.restart(),zn&&console.log(f+this.stackID(t)+" (restarted)"),this.advanceFully(t,l))continue}let n=t.split(),s=f;for(let t=0;n.forceReduce()&&t<10;t++){if(zn&&console.log(s+this.stackID(n)+" (via force-reduce)"),this.advanceFully(n,l))break;zn&&(s=this.stackID(n)+" -> ")}for(c of t.recoverByInsert(e))zn&&console.log(f+this.stackID(c)+" (via recover-insert)"),this.advanceFully(c,l);this.stream.end>t.pos?(r==t.pos&&(r++,e=0),t.recoverByDelete(e,r),zn&&console.log(f+this.stackID(t)+` (via recover-delete ${this.parser.getName(e)})`),Mn(t,l)):(!h||h.score<t.score)&&(h=t)}return h}stackToTree(t){return t.close(),kn.Tree.build({buffer:An.create(t),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:t.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(t){let e=(Ln=Ln||new WeakMap).get(t);return e||Ln.set(t,e=String.fromCodePoint(this.nextStackID++)),e+t}}function Mn(r,n){for(let e=0;e<n.length;e++){let t=n[e];if(t.pos==r.pos&&t.sameState(r))return void(n[e].score<r.score&&(n[e]=r))}n.push(r)}class Bn{constructor(t,e,r){this.source=t,this.flags=e,this.disabled=r}allows(t){return!this.disabled||0==this.disabled[t]}}const jn=t=>t;class Vn extends kn.Parser{constructor(r){if(super(),this.wrappers=[],13!=r.version)throw new RangeError(`Parser version (${r.version}) doesn't match runtime version (13)`);let e=r.nodeNames.split(" ");this.minRepeatTerm=e.length;for(let t=0;t<r.repeatNodeCount;t++)e.push("");let n=Object.keys(r.topRules).map(t=>r.topRules[t][1]),s=[];for(let t=0;t<e.length;t++)s.push([]);function i(t,e,r){s[t].push([e,e.deserialize(String(r))])}if(r.nodeProps)for(var o of r.nodeProps){var a=o[0];for(let e=1;e<o.length;){var l=o[e++];if(0<=l)i(l,a,o[e++]);else{var h=o[e+-l];for(let t=-l;0<t;t--)i(o[e++],a,h);e++}}}this.nodeSet=new kn.NodeSet(e.map((t,e)=>kn.NodeType.define({name:e>=this.minRepeatTerm?void 0:t,id:e,props:s[e],top:-1<n.indexOf(e),error:0==e,skipped:r.skippedNodes&&-1<r.skippedNodes.indexOf(e)}))),this.strict=!1,this.bufferLength=kn.DefaultBufferLength;let u=Nn(r.tokenData);if(this.context=r.context,this.specialized=new Uint16Array(r.specialized?r.specialized.length:0),this.specializers=[],r.specialized)for(let t=0;t<r.specialized.length;t++)this.specialized[t]=r.specialized[t].term,this.specializers[t]=r.specialized[t].get;this.states=Nn(r.states,Uint32Array),this.data=Nn(r.stateData),this.goto=Nn(r.goto),this.maxTerm=r.maxTerm,this.tokenizers=r.tokenizers.map(t=>"number"==typeof t?new Tn(u,t):t),this.topRules=r.topRules,this.dialects=r.dialects||{},this.dynamicPrecedences=r.dynamicPrecedences||null,this.tokenPrecTable=r.tokenPrec,this.termNames=r.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(t,e,r){let n=new Fn(this,t,e,r);for(var s of this.wrappers)n=s(n,t,e,r);return n}getGoto(e,r,n=!1){var s=this.goto;if(r>=s[0])return-1;for(let t=s[r+1];;){var i=s[t++],o=1&i,a=s[t++];if(o&&n)return a;for(var l=t+(i>>1);t<l;t++)if(s[t]==e)return a;if(o)return-1}}hasAction(n,s){var i=this.data;for(let r=0;r<2;r++)for(let t=this.stateSlot(n,r?2:1),e;;t+=3){if(65535==(e=i[t])){if(1!=i[t+1]){if(2==i[t+1])return Qn(i,t+2);break}e=i[t=Qn(i,t+2)]}if(e==s||0==e)return Qn(i,t+1)}return 0}stateSlot(t,e){return this.states[6*t+e]}stateFlag(t,e){return 0<(this.stateSlot(t,0)&e)}validAction(e,r){if(r==this.stateSlot(e,4))return!0;for(let t=this.stateSlot(e,1);;t+=3){if(65535==this.data[t]){if(1!=this.data[t+1])return!1;t=Qn(this.data,t+2)}if(r==Qn(this.data,t+1))return!0}}nextStates(e){let n=[];for(let t=this.stateSlot(e,1);;t+=3){if(65535==this.data[t]){if(1!=this.data[t+1])break;t=Qn(this.data,t+2)}if(0==(1&this.data[t+2])){let r=this.data[t+1];n.some((t,e)=>1&e&&t==r)||n.push(this.data[t],r)}}return n}overrides(t,e){e=Un(this.data,this.tokenPrecTable,e);return e<0||Un(this.data,this.tokenPrecTable,t)<e}configure(r){let t=Object.assign(Object.create(Vn.prototype),this);if(r.props&&(t.nodeSet=this.nodeSet.extend(...r.props)),r.top){var e=this.topRules[r.top];if(!e)throw new RangeError(`Invalid top rule name ${r.top}`);t.top=e}return r.tokenizers&&(t.tokenizers=this.tokenizers.map(e=>{var t=r.tokenizers.find(t=>t.from==e);return t?t.to:e})),r.contextTracker&&(t.context=r.contextTracker),r.dialect&&(t.dialect=this.parseDialect(r.dialect)),null!=r.strict&&(t.strict=r.strict),r.wrap&&(t.wrappers=t.wrappers.concat(r.wrap)),null!=r.bufferLength&&(t.bufferLength=r.bufferLength),t}getName(t){return this.termNames?this.termNames[t]:String(t<=this.maxNode&&this.nodeSet.types[t].name||t)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(t){var e=this.dynamicPrecedences;return null!=e&&e[t]||0}parseDialect(t){let n=Object.keys(this.dialects),e=n.map(()=>!1);if(t)for(var r of t.split(" ")){r=n.indexOf(r);0<=r&&(e[r]=!0)}let s=null;for(let r=0;r<n.length;r++)if(!e[r])for(let t=this.dialects[n[r]],e;65535!=(e=this.data[t++]);)(s=s||new Uint8Array(this.maxTerm+1))[e]=1;return new Bn(t,e,s)}static deserialize(t){return new Vn(t)}}function Qn(t,e){return t[e]|t[e+1]<<16}function Un(r,n,s){for(let t=n,e;65535!=(e=r[t]);t++)if(e==s)return t-n;return-1}We.ContextTracker=class{constructor(t){this.start=t.start,this.shift=t.shift||jn,this.reduce=t.reduce||jn,this.reuse=t.reuse||jn,this.hash=t.hash||(()=>0),this.strict=!1!==t.strict}},We.ExternalTokenizer=class{constructor(t,e={}){this.token=t,this.contextual=!!e.contextual,this.fallback=!!e.fallback,this.extend=!!e.extend}},We.InputStream=On,We.LRParser=Vn,We.Stack=wn;var Hn={};const Gn=We.ExternalTokenizer,Xn=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288];Hn.getSymbolChars=new Gn(function(e){for(let t=0;;t++){if(e.next<0||-1<Xn.indexOf(e.next)||45==e.next&&62==e.peek(1)||124==e.next||46==e.next||35==e.next){0<t&&e.acceptToken(9);break}e.advance()}});const Yn=We["LRParser"];var Hn=Hn["getSymbolChars"];kr.parser=Yn.deserialize({version:13,states:"#SQYQROOOOQO'#C_'#C_O_QQO'#C^OOQP'#Cb'#CbQYQROOOdQRO,58xOOQP-E6`-E6`OOQP'#Ca'#CaOOQP'#Cc'#CcOoQRO'#C`OOQO'#Cj'#CjOzQQO1G.dOOQP-E6a-E6aOdQRO,59UOOQP7+$O7+$OOOQO1G.p1G.p",stateData:"!S~OZOS[OS~OXPO~O]TO~OXVO_SP`SP~OXVO_SX`SX~O_]O`^O~O",goto:"!T_PP`dhnsyPPPPPP!QTROSTQOSQYTR_]VWTX]QSORUSSXT]R[XRZT",nodeNames:"⚠ rules Rule Head Production Symbol",maxTerm:16,skippedNodes:[0],repeatNodeCount:2,tokenData:"#d~R^X^}pq}st!r}!O!}!O!P#Y#p#q#_#y#z}$f$g}#BY#BZ}$IS$I_}$I|$JO}$JT$JU}$KV$KW}&FU&FV}~!SYZ~X^}pq}#y#z}$f$g}#BY#BZ}$IS$I_}$I|$JO}$JT$JU}$KV$KW}&FU&FV}~!wQ[~OY!rZ~!r~#QP!`!a#T~#YO]~~#_O`~~#dO_~",tokenizers:[Hn,0],topRules:{rules:[0,1]},tokenPrec:0});const Jn=kr.parser;var Wn=Pe,Zn=Ne,qn=Fe,Kn=Ye,ts=Je,es=yr,rs=function(t){let e=Jn.parse(t),r=e.cursor(),n=[],s,i;do{if(r.type.isError)throw new Error("Parse error")}while("Head"===r.name?s=t.slice(r.from,r.to):"Production"===r.name?(i=[s],n.push(i)):"Symbol"===r.name&&i.push(t.slice(r.from,r.to)),r.next());return n};function ns(e){if(e.match(/^\s*$/))return{spec:e};try{return{grammar:new es(rs(e)),spec:e}}catch(t){return{error:t,spec:e}}}yr=class{constructor(t){this._element=t,this._masterElement=document.createElement("div"),this._masterElement.id="master",this._element.appendChild(this._masterElement),this._editElement=document.createElement("section"),this._masterElement.appendChild(this._editElement),this._editController=new Zn(this._editElement),this._editController.setDelegate(this),this._modeElement=document.createElement("section"),this._masterElement.appendChild(this._modeElement),this._modeController=new Kn(this._modeElement),this._modeController.setDelegate(this),this._errorElement=document.createElement("section"),this._masterElement.appendChild(this._errorElement),this._errorController=new ts(this._errorElement),this._errorController.setDelegate(this),this._transformElement=document.createElement("section"),this._masterElement.appendChild(this._transformElement),this._transformController=new qn(this._transformElement),this._transformController.setDelegate(this),this._analysisElement=document.createElement("section"),this._element.appendChild(this._analysisElement),this._analysisController=new Wn(this._analysisElement),this._analysisController.setDelegate(this),window.location.hash="",window.addEventListener("hashchange",function(){this._hashChanged()}.bind(this),!1),this._path="/",this._parse={spec:"# Type a grammar here:\n\n"},this._mode="edit",this._analysisController.reload(),this._editController.reload(),this._modeController.reload(),("edit"===this._mode?this._errorController:this._transformController).reload(),this._layout()}_hashChanged(){this._path=window.location.hash.slice(1),""==this._path&&(this._path="/"),this._analysisController.reload()}_layout(){"edit"===this._mode?(this._editElement.style.display="",this._transformElement.style.display="none",void 0===this._parse.error?(this._errorElement.style.display="none",this._editElement.style.top=this._modeElement.offsetHeight+"px"):(this._errorElement.style.display="",this._errorElement.style.top=this._modeElement.offsetHeight+"px",this._editElement.style.top=this._modeElement.offsetHeight+this._errorElement.offsetHeight+"px")):(this._editElement.style.display="none",this._errorElement.style.display="none",this._transformElement.style.display="",this._transformElement.style.top=this._modeElement.offsetHeight+"px")}getPath(){return this._path}getGrammar(){return this._parse.grammar}getSpec(){return this._parse.spec}getError(){return this._parse.error}getMode(){return this._mode}grammarChanged(t){this._parse={grammar:t,spec:t.toString()},this._analysisController.reload(),this._layout()}analyze(){this._parse=ns(this._editController.getSpec()),void 0===this._parse.error&&this._analysisController.reload(),this._errorController.reload(),this._layout()}transform(){this._parse=ns(this._editController.getSpec()),void 0===this._parse.error&&void 0!==this._parse.grammar&&(this._mode="transform",this._transformController.reload()),this._analysisController.reload(),this._errorController.reload(),this._modeController.reload(),this._layout()}edit(){this._mode="edit",this._analysisController.reload(),this._editController.reload(),this._modeController.reload(),this._layout()}};return yr}();
//# sourceMappingURL=application.js.map
//# sourceMappingURL=application.js.map
